# ğŸš€ æ— ç•Œå¾®å‰ç«¯è¯¦ç»†å®æ–½æ–¹æ¡ˆ

## é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†å°†ç¾½æ¯›çƒåœºé¢„å®šç³»ç»Ÿæ”¹é€ ä¸ºå¾®å‰ç«¯æ¶æ„çš„è¯¦ç»†å®æ–½æ–¹æ¡ˆï¼Œä½¿ç”¨æ— ç•Œ(wujie)æ¡†æ¶å®ç°Cç«¯(Vue3)å’ŒBç«¯(React19)çš„é›†æˆã€‚

### å½“å‰æ¶æ„
- **Cç«¯ç³»ç»Ÿ**ï¼šVue 3 + Element Plus + Pinia + Vite (ä¸»ç«¯å£)
- **Bç«¯ç³»ç»Ÿ**ï¼šReact 19 + Ant Design + Zustand + Vite (ç«¯å£5000)

### ç›®æ ‡æ¶æ„
```
ä¸»åº”ç”¨(Cç«¯) - Vue 3 + æ— ç•Œ
â”œâ”€â”€ é¦–é¡µã€å•†åŸã€è®ºå›ã€ç”¨æˆ·ä¸­å¿ƒç­‰ (åŸæœ‰åŠŸèƒ½)
â”œâ”€â”€ /admin/* è·¯ç”± â†’ åŠ è½½Bç«¯Reactåº”ç”¨
â””â”€â”€ å…±äº«çŠ¶æ€ç®¡ç†(ç”¨æˆ·ç™»å½•çŠ¶æ€ç­‰)

å­åº”ç”¨(Bç«¯) - React 19 
â”œâ”€â”€ ç‹¬ç«‹è¿è¡Œåœ¨ç«¯å£5000
â”œâ”€â”€ ç®¡ç†åå°æ‰€æœ‰åŠŸèƒ½
â””â”€â”€ æ¥æ”¶ä¸»åº”ç”¨ä¼ é€’çš„ç”¨æˆ·ä¿¡æ¯
```

## ç¬¬ä¸€é˜¶æ®µï¼šä¸»åº”ç”¨(Cç«¯Vue3)æ”¹é€ 

### 1.1 å®‰è£…ä¾èµ–

```bash
# åœ¨Cç«¯é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
pnpm add wujie-vue3
```

### 1.2 å…¨å±€é…ç½®æ— ç•Œ

åˆ›å»º `src/plugins/wujie.js`ï¼š

```javascript
import { bus, setupApp, preloadApp, startApp } from 'wujie'
import { ElMessage } from 'element-plus'

// æ— ç•Œé…ç½®
const wujieConfig = {
  // å­åº”ç”¨é…ç½®
  apps: {
    'react-admin': {
      // å¼€å‘ç¯å¢ƒåœ°å€
      devUrl: 'http://localhost:5000',
      // ç”Ÿäº§ç¯å¢ƒåœ°å€  
      prodUrl: '/admin-static',
      // é¢„åŠ è½½
      preload: true,
      // ä¿æ´»æ¨¡å¼
      alive: true,
      // è·¯ç”±åŒæ­¥
      sync: true,
      // è‡ªå®šä¹‰fetch
      fetch: (url, options) => {
        return window.fetch(url, {
          ...options,
          headers: {
            ...options?.headers,
            'Access-Control-Allow-Origin': '*',
          }
        })
      },
      // å­åº”ç”¨åŠ è½½å‰
      beforeLoad: (appWindow) => {
        console.log('å­åº”ç”¨åŠ è½½å‰:', appWindow)
      },
      // å­åº”ç”¨åŠ è½½å
      beforeMount: (appWindow) => {
        console.log('å­åº”ç”¨æŒ‚è½½å‰:', appWindow)
      },
      // å­åº”ç”¨æŒ‚è½½å
      afterMount: (appWindow) => {
        console.log('å­åº”ç”¨æŒ‚è½½å:', appWindow)
      },
      // å­åº”ç”¨å¸è½½å‰
      beforeUnmount: (appWindow) => {
        console.log('å­åº”ç”¨å¸è½½å‰:', appWindow)
      },
      // å­åº”ç”¨å¸è½½å
      afterUnmount: (appWindow) => {
        console.log('å­åº”ç”¨å¸è½½å:', appWindow)
      }
    }
  }
}

// åˆå§‹åŒ–æ— ç•Œ
export function initWujie() {
  // è®¾ç½®å­åº”ç”¨
  setupApp({
    name: 'react-admin',
    url: process.env.NODE_ENV === 'development' 
      ? wujieConfig.apps['react-admin'].devUrl 
      : wujieConfig.apps['react-admin'].prodUrl,
    alive: wujieConfig.apps['react-admin'].alive,
    ...wujieConfig.apps['react-admin']
  })

  // é¢„åŠ è½½å­åº”ç”¨
  if (wujieConfig.apps['react-admin'].preload) {
    preloadApp({
      name: 'react-admin',
      url: process.env.NODE_ENV === 'development' 
        ? wujieConfig.apps['react-admin'].devUrl 
        : wujieConfig.apps['react-admin'].prodUrl
    })
  }
}

// å¯åŠ¨å­åº”ç”¨
export function startReactAdmin(container, props = {}) {
  return startApp({
    name: 'react-admin',
    url: process.env.NODE_ENV === 'development' 
      ? wujieConfig.apps['react-admin'].devUrl 
      : wujieConfig.apps['react-admin'].prodUrl,
    el: container,
    props,
    alive: true,
    sync: true
  })
}

export { bus }
```

### 1.3 åœ¨main.jsä¸­åˆå§‹åŒ–

ä¿®æ”¹ `src/main.js`ï¼š

```javascript
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import '@/assets/common.css'

// å¯¼å…¥æ— ç•Œé…ç½®
import { initWujie } from '@/plugins/wujie'

const app = createApp(App)
const pinia = createPinia()

pinia.use(piniaPluginPersistedstate)

app.use(pinia)
app.use(router)
app.use(ElementPlus)

// åˆå§‹åŒ–æ— ç•Œ
initWujie()

app.mount('#app')
```

### 1.4 åˆ›å»ºç®¡ç†åå°å®¹å™¨ç»„ä»¶

åˆ›å»º `src/views/admin/AdminContainer.vue`ï¼š

```vue
<template>
  <div class="admin-container">
    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="loading" class="loading-container">
      <el-loading-spinner />
      <p>æ­£åœ¨åŠ è½½ç®¡ç†åå°...</p>
    </div>
    
    <!-- æ— ç•Œå®¹å™¨ -->
    <WujieVue 
      v-show="!loading"
      name="react-admin"
      :url="adminUrl"
      :props="adminProps"
      :sync="true"
      :alive="true"
      width="100%"
      height="100vh"
      @mounted="handleMounted"
      @unmounted="handleUnmounted"
      @error="handleError"
    />
  </div>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue'
import WujieVue from 'wujie-vue3'
import { useUserStore } from '@/stores'
import { ElMessage } from 'element-plus'
import { bus } from '@/plugins/wujie'

const userStore = useUserStore()
const loading = ref(true)

// è®¡ç®—ç®¡ç†åå°URL
const adminUrl = computed(() => {
  return import.meta.env.DEV 
    ? 'http://localhost:5000' 
    : '/admin-static'
})

// ä¼ é€’ç»™å­åº”ç”¨çš„æ•°æ®
const adminProps = computed(() => ({
  userInfo: userStore.userinfo,
  token: userStore.token,
  theme: 'light', // å¯ä»¥ä¼ é€’ä¸»é¢˜é…ç½®
  language: 'zh-CN' // è¯­è¨€é…ç½®
}))

// å­åº”ç”¨æŒ‚è½½å®Œæˆ
const handleMounted = () => {
  loading.value = false
  console.log('ç®¡ç†åå°åŠ è½½å®Œæˆ')
  
  // é€šçŸ¥å­åº”ç”¨ç”¨æˆ·ä¿¡æ¯
  bus.$emit('user-info-updated', adminProps.value)
}

// å­åº”ç”¨å¸è½½
const handleUnmounted = () => {
  console.log('ç®¡ç†åå°å·²å¸è½½')
}

// å­åº”ç”¨åŠ è½½é”™è¯¯
const handleError = (error) => {
  loading.value = false
  console.error('ç®¡ç†åå°åŠ è½½å¤±è´¥:', error)
  ElMessage.error('ç®¡ç†åå°åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•')
}

// ç›‘å¬ç”¨æˆ·ä¿¡æ¯å˜åŒ–
const handleUserInfoChange = () => {
  if (!loading.value) {
    bus.$emit('user-info-updated', adminProps.value)
  }
}

onMounted(() => {
  // ç›‘å¬ç”¨æˆ·ä¿¡æ¯å˜åŒ–
  userStore.$subscribe(handleUserInfoChange)
  
  // ç›‘å¬å­åº”ç”¨æ¶ˆæ¯
  bus.$on('admin-logout', () => {
    userStore.logout()
    ElMessage.success('å·²é€€å‡ºç™»å½•')
  })
  
  bus.$on('admin-navigate', (path) => {
    // å¤„ç†å­åº”ç”¨å¯¼èˆªè¯·æ±‚
    console.log('å­åº”ç”¨è¯·æ±‚å¯¼èˆª:', path)
  })
})

onUnmounted(() => {
  // æ¸…ç†äº‹ä»¶ç›‘å¬
  bus.$off('admin-logout')
  bus.$off('admin-navigate')
})
</script>

<style scoped>
.admin-container {
  width: 100%;
  height: 100vh;
  position: relative;
}

.loading-container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: #f5f5f5;
}

.loading-container p {
  margin-top: 16px;
  color: #666;
  font-size: 14px;
}
</style>
```

### 1.5 æ›´æ–°è·¯ç”±é…ç½®

ä¿®æ”¹ `src/router/index.js`ï¼Œç§»é™¤åŸæœ‰çš„adminè·¯ç”±ï¼Œæ·»åŠ æ–°çš„å®¹å™¨è·¯ç”±ï¼š

```javascript
import { createRouter, createWebHistory } from 'vue-router'
import { useUserStore } from '@/stores'

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: [
    {
      path: '/',
      component: () => import('@/views/layout/LayOut.vue'),
      redirect: '/home',
      meta: { title: 'æ­¦æ±‰ç†å·¥å¤§å­¦å—æ¹–æ ¡åŒºç¾½æ¯›çƒåœºé¢„å®šå‰å°' },
      children: [
        // ... ä¿ç•™åŸæœ‰çš„Cç«¯è·¯ç”±
        {
          path: '/home',
          component: () => import('@/views/home/HomeView.vue'),
          meta: { title: 'æ­¦æ±‰ç†å·¥å¤§å­¦å—æ¹–æ ¡åŒºç¾½æ¯›çƒåœºé¢„å®šå‰å°' },
        },
        // ... å…¶ä»–åŸæœ‰è·¯ç”±ä¿æŒä¸å˜
      ],
    },
    // æ–°çš„ç®¡ç†åå°è·¯ç”± - ä½¿ç”¨æ— ç•Œå®¹å™¨
    {
      path: '/admin/:pathMatch(.*)*',
      component: () => import('@/views/admin/AdminContainer.vue'),
      meta: { 
        requiresAdmin: true, 
        title: 'ç®¡ç†åå°',
        keepAlive: false // ä¸ç¼“å­˜ï¼Œç¡®ä¿æ¯æ¬¡éƒ½æ˜¯æœ€æ–°çŠ¶æ€
      },
    },
    {
      path: '/login',
      component: () => import('@/views/login/Login.vue'),
      meta: { title: 'ç™»å½•/æ³¨å†Œ' },
      children: [
        {
          path: 'forget-password',
          component: () => import('@/views/login/ForgetPassword.vue'),
          meta: { title: 'æ‰¾å›å¯†ç ' },
        },
      ],
    },
  ],
})

// è·¯ç”±å®ˆå«ä¿æŒä¸å˜
router.beforeEach((to, from, next) => {
  // è®¾ç½®é¡µé¢æ ‡é¢˜
  if (to.meta.title) {
    document.title = to.meta.title
  }

  const userStore = useUserStore()

  if (to.meta.requiresAuth) {
    if (userStore.token && !userStore.isTokenExpired()) {
      next()
    } else {
      if (userStore.token && userStore.isTokenExpired()) {
        userStore.logout()
        ElMessage.warning('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
      }
      next({
        path: '/login',
        query: { redirect: to.fullPath }
      })
    }
  } else if (to.meta.requiresAdmin) {
    if (userStore.token && !userStore.isTokenExpired()) {
      if (userStore.userinfo?.role === 'ROLE_ADMIN') {
        next()
      } else {
        ElMessage.error('æ‚¨æ²¡æœ‰è®¿é—®ç®¡ç†åå°çš„æƒé™')
        next('/')
      }
    } else {
      if (userStore.token && userStore.isTokenExpired()) {
        userStore.logout()
        ElMessage.warning('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
      }
      next({
        path: '/login',
        query: { redirect: to.fullPath }
      })
    }
  } else {
    if (userStore.token && userStore.isTokenExpired() && to.meta.requiresAuth) {
      userStore.logout()
    }
    next()
  }
})

export default router
```

## ç¬¬äºŒé˜¶æ®µï¼šå­åº”ç”¨(Bç«¯React19)æ”¹é€ 

### 2.1 ä¿®æ”¹å…¥å£æ–‡ä»¶

ä¿®æ”¹ `admin-frontend/src/main.tsx`ï¼š

```typescript
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import App from './App.tsx'
import './index.css'

// å£°æ˜å…¨å±€ç±»å‹
declare global {
  interface Window {
    __POWERED_BY_WUJIE__?: boolean
    __WUJIE_MOUNT?: () => void
    __WUJIE_UNMOUNT?: () => void
    __WUJIE?: {
      props?: any
      bus?: any
    }
  }
}

let root: any = null

// æ¸²æŸ“å‡½æ•°
function render(props: any = {}) {
  const container = document.querySelector('#root')
  if (container) {
    root = createRoot(container)
    root.render(
      <StrictMode>
        <App {...props} />
      </StrictMode>
    )
  }
}

// å¸è½½å‡½æ•°
function unmount() {
  if (root) {
    root.unmount()
    root = null
  }
}

// åˆ¤æ–­æ˜¯å¦åœ¨æ— ç•Œç¯å¢ƒä¸­
if (window.__POWERED_BY_WUJIE__) {
  // åœ¨æ— ç•Œç¯å¢ƒä¸­
  window.__WUJIE_MOUNT = () => {
    const props = window.__WUJIE?.props || {}
    render(props)
  }
  
  window.__WUJIE_UNMOUNT = () => {
    unmount()
  }
} else {
  // ç‹¬ç«‹è¿è¡Œ
  render()
}

// ç›‘å¬æ— ç•ŒPropsæ›´æ–°
if (window.__WUJIE?.bus) {
  window.__WUJIE.bus.$on('user-info-updated', (props: any) => {
    // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†ä¸»åº”ç”¨ä¼ é€’çš„æ•°æ®æ›´æ–°
    console.log('æ”¶åˆ°ä¸»åº”ç”¨æ•°æ®æ›´æ–°:', props)
  })
}
```

### 2.2 åˆ›å»ºæ— ç•Œé€šä¿¡Hook

åˆ›å»º `admin-frontend/src/hooks/useWujie.ts`ï¼š

```typescript
import { useEffect, useState } from 'react'

interface WujieProps {
  userInfo?: any
  token?: string
  theme?: string
  language?: string
}

export function useWujie() {
  const [isWujie] = useState(!!window.__POWERED_BY_WUJIE__)
  const [wujieProps, setWujieProps] = useState<WujieProps>({})

  useEffect(() => {
    if (!isWujie) return

    // è·å–åˆå§‹props
    const initialProps = window.__WUJIE?.props || {}
    setWujieProps(initialProps)

    // ç›‘å¬propsæ›´æ–°
    const handlePropsUpdate = (props: WujieProps) => {
      setWujieProps(props)
    }

    if (window.__WUJIE?.bus) {
      window.__WUJIE.bus.$on('user-info-updated', handlePropsUpdate)
      
      return () => {
        window.__WUJIE.bus.$off('user-info-updated', handlePropsUpdate)
      }
    }
  }, [isWujie])

  // å‘ä¸»åº”ç”¨å‘é€æ¶ˆæ¯
  const emitToParent = (event: string, data?: any) => {
    if (isWujie && window.__WUJIE?.bus) {
      window.__WUJIE.bus.$emit(event, data)
    }
  }

  // å¯¼èˆªåˆ°ä¸»åº”ç”¨è·¯ç”±
  const navigateToParent = (path: string) => {
    emitToParent('admin-navigate', path)
  }

  // é€€å‡ºç™»å½•
  const logout = () => {
    emitToParent('admin-logout')
  }

  return {
    isWujie,
    wujieProps,
    emitToParent,
    navigateToParent,
    logout
  }
}
```

### 2.3 æ›´æ–°Appç»„ä»¶

ä¿®æ”¹ `admin-frontend/src/App.tsx`ï¼š

```typescript
import React, { Suspense, useEffect } from 'react'
import { BrowserRouter } from 'react-router-dom'
import { ConfigProvider } from 'antd'
import zhCN from 'antd/locale/zh_CN'
import router from './router'
import { RouterProvider } from 'react-router-dom'
import { useWujie } from './hooks/useWujie'

interface AppProps {
  userInfo?: any
  token?: string
  theme?: string
  language?: string
}

function App(props: AppProps) {
  const { isWujie, wujieProps } = useWujie()
  
  // åˆå¹¶props
  const finalProps = isWujie ? wujieProps : props

  useEffect(() => {
    // å¤„ç†ä»ä¸»åº”ç”¨ä¼ é€’çš„ç”¨æˆ·ä¿¡æ¯
    if (finalProps.userInfo) {
      console.log('æ”¶åˆ°ç”¨æˆ·ä¿¡æ¯:', finalProps.userInfo)
      // å¯ä»¥æ›´æ–°å…¨å±€çŠ¶æ€
    }
    
    if (finalProps.token) {
      console.log('æ”¶åˆ°token:', finalProps.token)
      // å¯ä»¥è®¾ç½®axiosé»˜è®¤header
    }
  }, [finalProps])

  return (
    <ConfigProvider locale={zhCN}>
      <Suspense fallback={<div>Loading...</div>}>
        <RouterProvider router={router} />
      </Suspense>
    </ConfigProvider>
  )
}

export default App
```

### 2.4 æ›´æ–°è·¯ç”±é…ç½®

ä¿®æ”¹ `admin-frontend/src/router/index.tsx`ï¼Œè°ƒæ•´base pathï¼š

```typescript
import { createBrowserRouter, Navigate } from 'react-router-dom'
import { ROUTES } from '@/types/routes'
import { lazy } from 'react'

// ... ä¿æŒç»„ä»¶å¯¼å…¥ä¸å˜

// è·å–base path
const getBasePath = () => {
  if (window.__POWERED_BY_WUJIE__) {
    // åœ¨æ— ç•Œç¯å¢ƒä¸­ï¼Œè·¯ç”±ç”±ä¸»åº”ç”¨ç®¡ç†
    return ''
  }
  return ''
}

const router = createBrowserRouter([
  {
    path: '/',
    element: <Navigate to={ROUTES.ADMIN} replace />
  },
  {
    path: ROUTES.ADMIN,
    element: <Admin />,
    handle: {
      meta: {
        title: 'é¦–é¡µ',
      },
    },
    children: [
      // ... ä¿æŒåŸæœ‰å­è·¯ç”±ä¸å˜
    ],
  }
], {
  basename: getBasePath()
})

export default router
```

### 2.5 é…ç½®å¼€å‘ç¯å¢ƒè·¨åŸŸ

ä¿®æ”¹ `admin-frontend/vite.config.ts`ï¼š

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 5000,
    open: false, // æ”¹ä¸ºfalseï¼Œé¿å…è‡ªåŠ¨æ‰“å¼€
    cors: true, // å¯ç”¨CORS
    headers: {
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type, Authorization',
    },
  },
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    minify: 'esbuild',
  },
})
```

## ç¬¬ä¸‰é˜¶æ®µï¼šåº”ç”¨é—´é€šä¿¡é…ç½®

### 3.1 ç”¨æˆ·çŠ¶æ€åŒæ­¥

åœ¨ä¸»åº”ç”¨ä¸­åˆ›å»º `src/composables/useAdminSync.js`ï¼š

```javascript
import { watch } from 'vue'
import { useUserStore } from '@/stores'
import { bus } from '@/plugins/wujie'

export function useAdminSync() {
  const userStore = useUserStore()

  // ç›‘å¬ç”¨æˆ·çŠ¶æ€å˜åŒ–ï¼ŒåŒæ­¥åˆ°å­åº”ç”¨
  watch(
    () => userStore.userinfo,
    (newUserInfo) => {
      bus.$emit('user-info-updated', {
        userInfo: newUserInfo,
        token: userStore.token
      })
    },
    { deep: true }
  )

  watch(
    () => userStore.token,
    (newToken) => {
      bus.$emit('user-info-updated', {
        userInfo: userStore.userinfo,
        token: newToken
      })
    }
  )

  // å¤„ç†å­åº”ç”¨å‘é€çš„æ¶ˆæ¯
  bus.$on('admin-user-updated', (userData) => {
    // å­åº”ç”¨æ›´æ–°äº†ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ­¥åˆ°ä¸»åº”ç”¨
    userStore.updateUserInfo(userData)
  })

  return {
    syncUserToAdmin: () => {
      bus.$emit('user-info-updated', {
        userInfo: userStore.userinfo,
        token: userStore.token
      })
    }
  }
}
```

### 3.2 APIè¯·æ±‚ç»Ÿä¸€é…ç½®

åœ¨å­åº”ç”¨ä¸­åˆ›å»º `admin-frontend/src/utils/request.ts`ï¼š

```typescript
import axios from 'axios'
import { message } from 'antd'

// åˆ›å»ºaxioså®ä¾‹
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 10000,
})

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  (config) => {
    // è·å–token - ä¼˜å…ˆä»æ— ç•Œpropsè·å–ï¼Œå…¶æ¬¡ä»localStorage
    let token = ''
    
    if (window.__WUJIE?.props?.token) {
      token = window.__WUJIE.props.token
    } else {
      token = localStorage.getItem('token') || ''
    }
    
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  (response) => {
    return response.data
  },
  (error) => {
    if (error.response?.status === 401) {
      // tokenè¿‡æœŸï¼Œé€šçŸ¥ä¸»åº”ç”¨é€€å‡ºç™»å½•
      if (window.__WUJIE?.bus) {
        window.__WUJIE.bus.$emit('admin-logout')
      } else {
        // ç‹¬ç«‹è¿è¡Œæ—¶çš„å¤„ç†
        localStorage.removeItem('token')
        window.location.href = '/login'
      }
    } else {
      message.error(error.response?.data?.message || 'è¯·æ±‚å¤±è´¥')
    }
    
    return Promise.reject(error)
  }
)

export default request
```

## ç¬¬å››é˜¶æ®µï¼šæ„å»ºä¸éƒ¨ç½²é…ç½®

### 4.1 å¼€å‘ç¯å¢ƒé…ç½®

åˆ›å»ºæ ¹ç›®å½•çš„å¼€å‘è„šæœ¬ `dev-microfrontend.js`ï¼š

```javascript
const { spawn } = require('child_process')
const chalk = require('chalk')

console.log(chalk.blue('ğŸš€ å¯åŠ¨å¾®å‰ç«¯å¼€å‘ç¯å¢ƒ'))

// å¯åŠ¨ä¸»åº”ç”¨ (Cç«¯)
const mainApp = spawn('pnpm', ['dev'], {
  stdio: 'inherit',
  shell: true,
  cwd: process.cwd()
})

// å¯åŠ¨å­åº”ç”¨ (Bç«¯)
const subApp = spawn('pnpm', ['dev'], {
  stdio: 'inherit', 
  shell: true,
  cwd: './admin-frontend'
})

console.log(chalk.green('âœ… ä¸»åº”ç”¨å¯åŠ¨ä¸­...'))
console.log(chalk.green('âœ… å­åº”ç”¨å¯åŠ¨ä¸­...'))
console.log(chalk.yellow('ğŸ“ ä¸»åº”ç”¨åœ°å€: http://localhost:5173'))
console.log(chalk.yellow('ğŸ“ å­åº”ç”¨åœ°å€: http://localhost:5000'))

// å¤„ç†è¿›ç¨‹é€€å‡º
process.on('SIGINT', () => {
  console.log(chalk.red('\nğŸ›‘ æ­£åœ¨å…³é—­å¾®å‰ç«¯åº”ç”¨...'))
  mainApp.kill()
  subApp.kill()
  process.exit()
})
```

åœ¨æ ¹ç›®å½• `package.json` æ·»åŠ è„šæœ¬ï¼š

```json
{
  "scripts": {
    "dev:micro": "node dev-microfrontend.js",
    "build:micro": "pnpm build && cd admin-frontend && pnpm build"
  }
}
```

### 4.2 ç”Ÿäº§ç¯å¢ƒé…ç½®

#### Nginxé…ç½®ç¤ºä¾‹

åˆ›å»º `nginx.conf`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # ä¸»åº”ç”¨ (Cç«¯)
    location / {
        root /var/www/main-app;
        try_files $uri $uri/ /index.html;
        index index.html;
    }
    
    # å­åº”ç”¨é™æ€èµ„æº (Bç«¯)
    location /admin-static/ {
        alias /var/www/sub-app/;
        try_files $uri $uri/ /index.html;
        
        # æ·»åŠ CORSå¤´
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';
    }
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://backend-server:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

#### Dockeréƒ¨ç½²é…ç½®

åˆ›å»º `Dockerfile.micro`ï¼š

```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM node:18-alpine as builder

# æ„å»ºä¸»åº”ç”¨
WORKDIR /app/main
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install
COPY . .
RUN pnpm build

# æ„å»ºå­åº”ç”¨
WORKDIR /app/sub
COPY admin-frontend/package.json admin-frontend/pnpm-lock.yaml ./
RUN pnpm install
COPY admin-frontend/ .
RUN pnpm build

# ç”Ÿäº§é•œåƒ
FROM nginx:alpine
COPY --from=builder /app/main/dist /var/www/main-app
COPY --from=builder /app/sub/dist /var/www/sub-app
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

## ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ä¸éªŒè¯

### 5.1 åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] ä¸»åº”ç”¨ç‹¬ç«‹è®¿é—®æ­£å¸¸
- [ ] å­åº”ç”¨ç‹¬ç«‹è®¿é—®æ­£å¸¸  
- [ ] ä¸»åº”ç”¨ä¸­å¯ä»¥æ­£å¸¸åŠ è½½å­åº”ç”¨
- [ ] ç”¨æˆ·ç™»å½•çŠ¶æ€åœ¨ä¸¤ä¸ªåº”ç”¨é—´åŒæ­¥
- [ ] è·¯ç”±è·³è½¬åŠŸèƒ½æ­£å¸¸
- [ ] APIè¯·æ±‚æºå¸¦æ­£ç¡®çš„token
- [ ] åº”ç”¨é—´é€šä¿¡åŠŸèƒ½æ­£å¸¸
- [ ] é¡µé¢åˆ·æ–°åçŠ¶æ€ä¿æŒ
- [ ] æµè§ˆå™¨å‰è¿›åé€€åŠŸèƒ½æ­£å¸¸
- [ ] å“åº”å¼å¸ƒå±€é€‚é…

### 5.2 æ€§èƒ½æµ‹è¯•

- [ ] é¦–å±åŠ è½½æ—¶é—´
- [ ] å­åº”ç”¨åˆ‡æ¢é€Ÿåº¦
- [ ] å†…å­˜ä½¿ç”¨æƒ…å†µ
- [ ] ç½‘ç»œè¯·æ±‚ä¼˜åŒ–

## æ€»ç»“

æœ¬æ–¹æ¡ˆå®ç°äº†ï¼š

1. **é›¶ä¾µå…¥é›†æˆ**ï¼šç°æœ‰ä»£ç æ”¹åŠ¨æœ€å°åŒ–
2. **å®Œå…¨éš”ç¦»**ï¼šæ ·å¼å’ŒJSä½œç”¨åŸŸå®Œå…¨éš”ç¦»
3. **çŠ¶æ€åŒæ­¥**ï¼šç”¨æˆ·ç™»å½•çŠ¶æ€åœ¨åº”ç”¨é—´å®æ—¶åŒæ­¥
4. **ç‹¬ç«‹å¼€å‘**ï¼šä¸¤ä¸ªåº”ç”¨å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
5. **ç»Ÿä¸€ä½“éªŒ**ï¼šç”¨æˆ·æ„ŸçŸ¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨

### æŠ€æœ¯ä¼˜åŠ¿

- ğŸš€ **æ€§èƒ½ä¼˜ç§€**ï¼šé¢„åŠ è½½å’Œä¿æ´»æœºåˆ¶ç¡®ä¿å¿«é€Ÿåˆ‡æ¢
- ğŸ”’ **å®‰å…¨éš”ç¦»**ï¼šåŸºäºiframeçš„æ²™ç®±æœºåˆ¶
- ğŸ› ï¸ **å¼€å‘å‹å¥½**ï¼šæ”¯æŒçƒ­æ›´æ–°å’Œç‹¬ç«‹è°ƒè¯•
- ğŸ“± **å“åº”å¼**ï¼šå®Œç¾æ”¯æŒç§»åŠ¨ç«¯é€‚é…
- ğŸ”„ **çŠ¶æ€ç®¡ç†**ï¼šæ— ç¼çš„è·¨åº”ç”¨çŠ¶æ€åŒæ­¥

è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥è®©æ‚¨å¿«é€Ÿå®ç°å¾®å‰ç«¯æ¶æ„ï¼ŒåŒæ—¶ä¿æŒä¼˜ç§€çš„å¼€å‘ä½“éªŒå’Œç”¨æˆ·ä½“éªŒã€‚
