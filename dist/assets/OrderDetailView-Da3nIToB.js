import{r as E,o as z,l as i,g as d,ai as j,h as t,k as p,f,j as r,w as c,x as n,a4 as H,P as Y,Q as J,m as W,a2 as $,an as G,E as m,a as Q,p as K,J as o,aE as X,aF as Z,aG as ss,A as v,i as ts,c as N}from"./index-GmfRbgMx.js";/* empty css                 */import{_ as es}from"./_plugin-vue_export-helper-DedD7E0N.js";/* empty css                        *//* empty css               *//* empty css                         */import{O as l,b as w,g as as,P as I,q as os,d as ns}from"./pay-BYbC_l-i.js";/* empty css                       *//* empty css                 *//* empty css                   */const is={class:"order-detail-container"},ls={key:0,class:"loading-container"},rs={key:1,class:"order-detail"},cs={class:"order-status-section"},ds={class:"status-icon"},us={class:"status-info"},ps={key:0},_s={key:1},ms={key:2},vs={class:"order-info-section"},fs={class:"info-grid"},ys={class:"info-item"},gs={class:"value"},ks={class:"info-item"},hs={class:"value"},Ps={key:0,class:"info-item"},Ds={class:"value"},Es={class:"info-item"},As={key:1,class:"info-item"},Ts={class:"value"},Cs={class:"info-item pickup-code-item"},Ns={key:0,class:"pickup-code"},ws={key:1,class:"pickup-code-pending"},Is={class:"products-section"},xs={class:"product-list"},Ss={class:"product-details"},bs={class:"product-name"},Os={key:0,class:"product-specs"},Ls={class:"product-price"},Bs={class:"product-quantity"},Us={class:"product-subtotal"},Rs={key:0,class:"payment-section"},Fs={class:"info-grid"},Ms={class:"info-item"},Vs={class:"value"},qs={key:0,class:"info-item"},zs={class:"value"},js={class:"info-item"},Hs={class:"amount-section"},Ys={class:"amount-details"},Js={class:"amount-item"},Ws={class:"amount-item total"},$s={class:"total-price"},Gs={class:"action-section"},Qs={key:2,class:"error-container"},Ks={__name:"OrderDetailView",setup(Xs){const g=Q(),x=G(),e=E(null),_=E(null),k=E(!1),h=async()=>{try{k.value=!0;const a=x.params.orderNo;if(!a){m.error("订单号不存在"),g.push("/orders");return}const s=await as(a);s.data.code===0?(e.value=s.data.data,e.value.status===l.PAID&&await S(a)):m.error(s.message||"获取订单详情失败")}catch(a){console.error("获取订单详情失败:",a),m.error("获取订单详情失败")}finally{k.value=!1}},S=async a=>{try{const s=await os(a);s.data.code===0&&(_.value=s.data.data)}catch(s){console.error("获取支付详情失败:",s)}},b=()=>{const a={orderNo:e.value.orderNo,amount:e.value.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(a)),g.push("/payment")},O=()=>{N.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await ns(e.value.orderNo);a.data.code===0?(m.success("订单取消成功"),await h()):m.error(a.message||"取消订单失败")}catch(a){console.error("取消订单失败:",a),m.error("取消订单失败")}}).catch(()=>{})},L=()=>{N.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(()=>{m.success("确认收货成功"),h()}).catch(()=>{})},A=()=>{g.go(-1)},B=a=>{switch(a){case l.UNPAID:return"warning";case l.PAID:return"success";case l.CANCELLED:return"danger";default:return"info"}},T=a=>{switch(a){case l.UNPAID:return"待支付";case l.PAID:return"已支付";case l.CANCELLED:return"已取消";default:return"未知状态"}},U=a=>{switch(a){case I.ALIPAY:return"支付宝";case I.WECHAT:return"微信支付";default:return"未知"}},P=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"";return z(()=>{h()}),(a,s)=>{const R=j,D=K,C=H,F=ts,y=W,M=$;return o(),i("div",is,[k.value?(o(),i("div",ls,[d(R,{rows:8,animated:""})])):e.value?(o(),i("div",rs,[t("div",cs,[t("div",ds,[e.value.status===r(l).PAID?(o(),f(D,{key:0,class:"success-icon",size:"60"},{default:c(()=>[d(r(X))]),_:1})):e.value.status===r(l).CANCELLED?(o(),f(D,{key:1,class:"error-icon",size:"60"},{default:c(()=>[d(r(Z))]),_:1})):(o(),f(D,{key:2,class:"warning-icon",size:"60"},{default:c(()=>[d(r(ss))]),_:1}))]),t("div",us,[t("h2",null,n(T(e.value.status)),1),e.value.status===r(l).PAID?(o(),i("p",ps,"您的订单已支付成功")):e.value.status===r(l).CANCELLED?(o(),i("p",_s,"订单已取消")):(o(),i("p",ms,"请尽快完成支付"))])]),t("div",vs,[s[6]||(s[6]=t("h3",null,"订单信息",-1)),t("div",fs,[t("div",ys,[s[0]||(s[0]=t("span",{class:"label"},"订单号：",-1)),t("span",gs,n(e.value.orderNo),1)]),t("div",ks,[s[1]||(s[1]=t("span",{class:"label"},"下单时间：",-1)),t("span",hs,n(P(e.value.createTime)),1)]),e.value.payTime?(o(),i("div",Ps,[s[2]||(s[2]=t("span",{class:"label"},"支付时间：",-1)),t("span",Ds,n(P(e.value.payTime)),1)])):p("",!0),t("div",Es,[s[3]||(s[3]=t("span",{class:"label"},"订单状态：",-1)),d(C,{type:B(e.value.status)},{default:c(()=>[v(n(T(e.value.status)),1)]),_:1},8,["type"])]),e.value.remarks?(o(),i("div",As,[s[4]||(s[4]=t("span",{class:"label"},"订单备注：",-1)),t("span",Ts,n(e.value.remarks),1)])):p("",!0),t("div",Cs,[s[5]||(s[5]=t("span",{class:"label"},"取件码：",-1)),e.value.status===r(l).PAID?(o(),i("span",Ns,n(e.value.pickupCode||"WHUT2024"),1)):(o(),i("span",ws," 支付成功后显示取件码 "))])])]),t("div",Is,[s[7]||(s[7]=t("h3",null,"商品信息",-1)),t("div",xs,[(o(!0),i(Y,null,J(e.value.orderItems,(u,V)=>(o(),i("div",{key:V,class:"product-item"},[d(F,{src:u.productImage,class:"product-image",fit:"cover"},null,8,["src"]),t("div",Ss,[t("div",bs,n(u.productName),1),u.specs?(o(),i("div",Os," 规格："+n(Object.entries(u.specs).map(([Zs,q])=>`${q}`).join("、")),1)):p("",!0),t("div",Ls,"¥"+n(u.productPrice.toFixed(2)),1)]),t("div",Bs,"x"+n(u.quantity),1),t("div",Us," ¥"+n((u.productPrice*u.quantity).toFixed(2)),1)]))),128))])]),_.value?(o(),i("div",Rs,[s[11]||(s[11]=t("h3",null,"支付信息",-1)),t("div",Fs,[t("div",Ms,[s[8]||(s[8]=t("span",{class:"label"},"支付方式：",-1)),t("span",Vs,n(U(_.value.payPlatform)),1)]),_.value.payTime?(o(),i("div",qs,[s[9]||(s[9]=t("span",{class:"label"},"支付时间：",-1)),t("span",zs,n(P(_.value.payTime)),1)])):p("",!0),t("div",js,[s[10]||(s[10]=t("span",{class:"label"},"支付状态：",-1)),d(C,{type:_.value.status===r(w).SUCCESS?"success":"warning"},{default:c(()=>[v(n(_.value.status===r(w).SUCCESS?"已支付":"未支付"),1)]),_:1},8,["type"])])])])):p("",!0),t("div",Hs,[s[14]||(s[14]=t("h3",null,"金额明细",-1)),t("div",Ys,[t("div",Js,[s[12]||(s[12]=t("span",null,"商品总价：",-1)),t("span",null,"¥"+n(e.value.totalPrice.toFixed(2)),1)]),t("div",Ws,[s[13]||(s[13]=t("span",null,"实付金额：",-1)),t("span",$s,"¥"+n(e.value.totalPrice.toFixed(2)),1)])])]),t("div",Gs,[d(y,{onClick:A},{default:c(()=>s[15]||(s[15]=[v("返回")])),_:1}),e.value.status===r(l).UNPAID?(o(),f(y,{key:0,type:"primary",onClick:b},{default:c(()=>s[16]||(s[16]=[v(" 立即支付 ")])),_:1})):p("",!0),e.value.status===r(l).UNPAID?(o(),f(y,{key:1,type:"danger",onClick:O},{default:c(()=>s[17]||(s[17]=[v(" 取消订单 ")])),_:1})):p("",!0),e.value.status===r(l).PAID?(o(),f(y,{key:2,type:"success",onClick:L},{default:c(()=>s[18]||(s[18]=[v(" 确认收货 ")])),_:1})):p("",!0)])])):(o(),i("div",Qs,[d(M,{description:"订单不存在或已被删除"},{default:c(()=>[d(y,{type:"primary",onClick:A},{default:c(()=>s[19]||(s[19]=[v("返回")])),_:1})]),_:1})]))])}}},dt=es(Ks,[["__scopeId","data-v-69822995"]]);export{dt as default};
