import{u as y,r as m,d as _,o as k,aW as o,c as B,E as l,a as N,q as p,p as A,M as S,j as c,l as d,w as f,v as D,B as M,s as R,aX as U,aY as V,i as v,n as w,aZ as T,S as z,F as L}from"./index-CBwtJ5i4.js";import{_ as O}from"./_plugin-vue_export-helper-CfPbstfH.js";const F={class:"admin-container"},P={key:0,class:"loading-container"},j={key:1,class:"error-container"},q={class:"error-message"},W={__name:"AdminContainer",setup(X){const s=y(),t=m(!0),i=m(!1),r=m(""),g=m(null),$=_(()=>{const n="/admin-static";return console.log(`ğŸ“ [AdminContainer] å­åº”ç”¨åœ°å€: ${n}`),console.log("ğŸŒ [AdminContainer] å½“å‰ç¯å¢ƒ: production"),n}),u=_(()=>{const n={userInfo:s.userinfo,token:s.token,theme:"light",language:"zh-CN",timestamp:Date.now()};return console.log("ğŸ“¦ [AdminContainer] ä¼ é€’ç»™å­åº”ç”¨çš„æ•°æ®:",n),n}),C=async()=>{try{if(console.log("ğŸ¯ [AdminContainer] å¼€å§‹å¯åŠ¨Reactå­åº”ç”¨..."),!g.value)throw new Error("å­åº”ç”¨å®¹å™¨å…ƒç´ ä¸å­˜åœ¨");await V(g.value,u.value),t.value=!1,i.value=!1,console.log("âœ… [AdminContainer] Reactå­åº”ç”¨å¯åŠ¨æˆåŠŸ"),setTimeout(()=>{o.$emit("user-info-updated",u.value),console.log("ğŸ“¤ [AdminContainer] å·²å‘å­åº”ç”¨å‘é€ç”¨æˆ·ä¿¡æ¯")},500)}catch(n){console.error("âŒ [AdminContainer] å­åº”ç”¨å¯åŠ¨å¤±è´¥:",n),h(n)}},h=n=>{t.value=!1,i.value=!0;const e=(n==null?void 0:n.message)||(n==null?void 0:n.toString())||"æœªçŸ¥é”™è¯¯";r.value=e,console.error("âŒ [AdminContainer] ç®¡ç†åå°åŠ è½½å¤±è´¥:",n),e.includes("Failed to fetch")?r.value="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œçŠ¶æ€æˆ–ç¨åé‡è¯•":e.includes("404")?r.value="ç®¡ç†åå°æœåŠ¡æœªå¯åŠ¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜":r.value=`åŠ è½½å¤±è´¥: ${e}`,l.error("ç®¡ç†åå°åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•")},E=async()=>{console.log("ğŸ”„ [AdminContainer] ç”¨æˆ·æ‰‹åŠ¨é‡æ–°åŠ è½½å­åº”ç”¨"),i.value=!1,t.value=!0,await C()},x=()=>{!t.value&&!i.value&&(console.log("ğŸ”„ [AdminContainer] ç”¨æˆ·ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼ŒåŒæ­¥åˆ°å­åº”ç”¨"),o.$emit("user-info-updated",u.value))};return k(()=>{var n;console.log("ğŸš€ [AdminContainer] ç»„ä»¶å·²æŒ‚è½½ï¼Œå¼€å§‹åˆå§‹åŒ–..."),console.log("ğŸŒ [AdminContainer] ç¯å¢ƒä¿¡æ¯:"),console.log("  - NODE_ENV:","production"),console.log("  - import.meta.env.DEV:",!1),console.log("  - import.meta.env.PROD:",!0),console.log("  - è®¡ç®—å‡ºçš„å­åº”ç”¨URL:",$.value),console.log("ğŸ“¦ [AdminContainer] ä¼ é€’ç»™å­åº”ç”¨çš„props:",u.value),((n=s.userinfo)==null?void 0:n.role)!=="ROLE_ADMIN"&&console.warn("âš ï¸ [AdminContainer] å½“å‰ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œå¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ç®¡ç†åå°"),s.$subscribe(x),setTimeout(async()=>{await C()},100),o.$on("admin-logout",()=>{console.log("ğŸ“¨ [AdminContainer] æ”¶åˆ°å­åº”ç”¨é€€å‡ºç™»å½•è¯·æ±‚"),B.confirm("æ‚¨ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ","ç¡®è®¤é€€å‡º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then(()=>{s.logout(),l.success("å·²é€€å‡ºç™»å½•"),window.location.href="/login"}).catch(()=>{console.log("ç”¨æˆ·å–æ¶ˆé€€å‡ºç™»å½•")})}),o.$on("admin-navigate",e=>{console.log("ğŸ“¨ [AdminContainer] æ”¶åˆ°å­åº”ç”¨å¯¼èˆªè¯·æ±‚:",e)}),o.$on("admin-user-updated",e=>{console.log("ğŸ“¨ [AdminContainer] æ”¶åˆ°å­åº”ç”¨ç”¨æˆ·ä¿¡æ¯æ›´æ–°:",e),s.updateUserInfo(e)}),o.$on("admin-message",({type:e,message:a})=>{console.log("ğŸ“¨ [AdminContainer] æ”¶åˆ°å­åº”ç”¨æ¶ˆæ¯:",{type:e,message:a}),e==="success"?l.success(a):e==="error"?l.error(a):e==="warning"?l.warning(a):l.info(a)})}),N(()=>{console.log("ğŸ—‘ï¸ [AdminContainer] ç»„ä»¶å³å°†å¸è½½ï¼Œæ¸…ç†äº‹ä»¶ç›‘å¬..."),o.$off("admin-logout"),o.$off("admin-navigate"),o.$off("admin-user-updated"),o.$off("admin-message")}),(n,e)=>{const a=D,b=R;return v(),p("div",F,[t.value?(v(),p("div",P,[c(a,{class:"loading-icon",size:40},{default:f(()=>[c(w(T))]),_:1}),e[0]||(e[0]=d("p",{class:"loading-text"},"æ­£åœ¨åŠ è½½ç®¡ç†åå°...",-1)),e[1]||(e[1]=d("p",{class:"loading-tip"},"é¦–æ¬¡åŠ è½½å¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…",-1))])):A("",!0),i.value?(v(),p("div",j,[c(a,{class:"error-icon",size:40},{default:f(()=>[c(w(z))]),_:1}),e[3]||(e[3]=d("p",{class:"error-text"},"ç®¡ç†åå°åŠ è½½å¤±è´¥",-1)),d("p",q,M(r.value),1),c(b,{type:"primary",onClick:E},{default:f(()=>e[2]||(e[2]=[L("é‡æ–°åŠ è½½")])),_:1})])):A("",!0),S(d("div",{ref_key:"subAppContainer",ref:g,id:"react-admin-container",class:"sub-app-container"},null,512),[[U,!t.value&&!i.value]])])}}},G=O(W,[["__scopeId","data-v-8a3cdbc3"]]);export{G as default};
