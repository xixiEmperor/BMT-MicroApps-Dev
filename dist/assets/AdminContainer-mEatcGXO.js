import{u as k,r as c,d as C,Z as b,o as A,aY as s,c as E,E as t,b as B,l as m,k as w,M as S,g as l,h as r,w as p,j as h,aZ as M,p as N,S as T,x as V,A as z,m as D,a_ as R,a$ as U,J as f}from"./index-GmfRbgMx.js";import{_ as Z}from"./_plugin-vue_export-helper-DedD7E0N.js";/* empty css                       *//* empty css                 *//* empty css                   */const j={class:"admin-container"},F={key:0,class:"loading-container"},J={key:1,class:"error-container"},L={class:"error-message"},P={__name:"AdminContainer",setup(Y){const u=k(),n=c(!0),o=c(!1),i=c(""),d=c(null),g=C(()=>({userInfo:u.userinfo,token:u.token,theme:"light",language:"zh-CN",timestamp:Date.now(),useRealtime:b()})),v=async()=>{try{if(!d.value)throw new Error("子应用容器元素不存在");await U(d.value,g.value),n.value=!1,o.value=!1}catch(e){x(e)}},x=e=>{n.value=!1,o.value=!0;const a=(e==null?void 0:e.message)||(e==null?void 0:e.toString())||"未知错误";i.value=a,a.includes("Failed to fetch")?i.value="网络连接失败，请检查网络状态或稍后重试":a.includes("404")?i.value="管理后台服务未启动，请联系管理员":i.value=`加载失败: ${a}`,t.error("管理后台加载失败，请刷新重试")},y=async()=>{o.value=!1,n.value=!0,await v()};return A(()=>{console.log(g.value),setTimeout(async()=>{await v()},100),s.$on("admin-logout",()=>{E.confirm("您确定要退出登录吗？","确认退出",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.logout(),t.success("已退出登录"),window.location.href="/login"}).catch(()=>{})}),s.$on("admin-navigate",e=>{console.log("📨 [AdminContainer] 收到子应用导航请求:",e)}),s.$on("admin-user-updated",e=>{u.updateUserInfo(e)}),s.$on("admin-message",({type:e,message:a})=>{e==="success"?t.success(a):e==="error"?t.error(a):e==="warning"?t.warning(a):t.info(a)})}),B(()=>{s.$off("admin-logout"),s.$off("admin-navigate"),s.$off("admin-user-updated"),s.$off("admin-message")}),(e,a)=>{const _=N,$=D;return f(),m("div",j,[n.value?(f(),m("div",F,[l(_,{class:"loading-icon",size:40},{default:p(()=>[l(h(M))]),_:1}),a[0]||(a[0]=r("p",{class:"loading-text"},"正在加载管理后台...",-1)),a[1]||(a[1]=r("p",{class:"loading-tip"},"首次加载可能需要几秒钟，请耐心等待",-1))])):w("",!0),o.value?(f(),m("div",J,[l(_,{class:"error-icon",size:40},{default:p(()=>[l(h(T))]),_:1}),a[3]||(a[3]=r("p",{class:"error-text"},"管理后台加载失败",-1)),r("p",L,V(i.value),1),l($,{type:"primary",onClick:y},{default:p(()=>a[2]||(a[2]=[z("重新加载")])),_:1})])):w("",!0),S(r("div",{ref_key:"subAppContainer",ref:d,id:"react-admin-container",class:"sub-app-container"},null,512),[[R,!n.value&&!o.value]])])}}},Q=Z(P,[["__scopeId","data-v-47418b67"]]);export{Q as default};
