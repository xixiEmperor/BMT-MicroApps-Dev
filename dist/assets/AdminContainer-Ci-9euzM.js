import{u as C,r as c,d as k,Z as B,o as E,aY as s,c as b,E as t,a as A,q as m,p as w,M as S,j as l,l as r,w as p,v as M,B as N,s as T,aZ as V,a_ as z,i as f,n as h,a$ as D,S as R,F as U}from"./index-Ba57xZaz.js";import{_ as F}from"./_plugin-vue_export-helper-DedD7E0N.js";/* empty css                       *//* empty css                 *//* empty css                   */const Z={class:"admin-container"},j={key:0,class:"loading-container"},q={key:1,class:"error-container"},L={class:"error-message"},P={__name:"AdminContainer",setup(Y){const u=C(),n=c(!0),o=c(!1),i=c(""),d=c(null),v=k(()=>({userInfo:u.userinfo,token:u.token,theme:"light",language:"zh-CN",timestamp:Date.now(),useRealtime:B()})),g=async()=>{try{if(!d.value)throw new Error("子应用容器元素不存在");await z(d.value,v.value),n.value=!1,o.value=!1}catch(e){x(e)}},x=e=>{n.value=!1,o.value=!0;const a=(e==null?void 0:e.message)||(e==null?void 0:e.toString())||"未知错误";i.value=a,a.includes("Failed to fetch")?i.value="网络连接失败，请检查网络状态或稍后重试":a.includes("404")?i.value="管理后台服务未启动，请联系管理员":i.value=`加载失败: ${a}`,t.error("管理后台加载失败，请刷新重试")},y=async()=>{o.value=!1,n.value=!0,await g()};return E(()=>{console.log(v.value),setTimeout(async()=>{await g()},100),s.$on("admin-logout",()=>{b.confirm("您确定要退出登录吗？","确认退出",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.logout(),t.success("已退出登录"),window.location.href="/login"}).catch(()=>{})}),s.$on("admin-navigate",e=>{console.log("📨 [AdminContainer] 收到子应用导航请求:",e)}),s.$on("admin-user-updated",e=>{u.updateUserInfo(e)}),s.$on("admin-message",({type:e,message:a})=>{e==="success"?t.success(a):e==="error"?t.error(a):e==="warning"?t.warning(a):t.info(a)})}),A(()=>{s.$off("admin-logout"),s.$off("admin-navigate"),s.$off("admin-user-updated"),s.$off("admin-message")}),(e,a)=>{const _=M,$=T;return f(),m("div",Z,[n.value?(f(),m("div",j,[l(_,{class:"loading-icon",size:40},{default:p(()=>[l(h(D))]),_:1}),a[0]||(a[0]=r("p",{class:"loading-text"},"正在加载管理后台...",-1)),a[1]||(a[1]=r("p",{class:"loading-tip"},"首次加载可能需要几秒钟，请耐心等待",-1))])):w("",!0),o.value?(f(),m("div",q,[l(_,{class:"error-icon",size:40},{default:p(()=>[l(h(R))]),_:1}),a[3]||(a[3]=r("p",{class:"error-text"},"管理后台加载失败",-1)),r("p",L,N(i.value),1),l($,{type:"primary",onClick:y},{default:p(()=>a[2]||(a[2]=[U("重新加载")])),_:1})])):w("",!0),S(r("div",{ref_key:"subAppContainer",ref:d,id:"react-admin-container",class:"sub-app-container"},null,512),[[V,!n.value&&!o.value]])])}}},Q=F(P,[["__scopeId","data-v-47418b67"]]);export{Q as default};
