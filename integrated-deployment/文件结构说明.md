# 部署文件结构说明

## 📁 完整文件结构

```
integrated-deployment/
├── README.md                           # 📖 完整部署指南
├── docker-compose.yml                  # 🐳 Docker Compose主配置
├── env.example                         # 🔧 环境变量模板
├── deploy.sh                          # 🚀 一键部署脚本
├── 文件结构说明.md                     # 📋 本文件
│
├── nginx/                              # 🌐 Nginx配置目录
│   ├── nginx.conf                      # ⚙️ Nginx主配置文件
│   └── conf.d/
│       ├── app.conf                    # 🔧 应用配置（简洁版）
│       └── app-detailed.conf           # 📝 应用配置（详细注释版）
│
├── docs/                               # 📚 学习文档目录
│   ├── Nginx学习文档.md                # 📖 Nginx完整学习指南
│   └── Docker学习文档.md               # 📖 Docker完整学习指南
│
└── 待创建目录/
    ├── dist/                           # 🎯 前端构建产物目录
    │   ├── index.html                  # Vue.js主应用
    │   ├── admin/                      # React管理后台
    │   └── assets/                     # 静态资源
    │
    ├── data/                           # 💾 数据持久化目录
    │   ├── postgres/                   # PostgreSQL数据
    │   ├── redis/                      # Redis数据
    │   └── uploads/                    # 用户上传文件
    │
    ├── nginx/
    │   ├── logs/                       # 📊 Nginx日志
    │   └── ssl/                        # 🔒 SSL证书（生产环境）
    │
    └── backups/                        # 🗄️ 数据备份目录
```

## 📋 文件说明

### 🔧 核心配置文件

#### `docker-compose.yml`
- **用途**: Docker服务编排配置
- **包含服务**:
  - `nginx`: Web服务器和反向代理
  - `backend-api`: 后端API服务
  - `websocket-server`: WebSocket实时服务
  - `postgres-db`: PostgreSQL数据库
  - `redis-cache`: Redis缓存

#### `env.example` 
- **用途**: 环境变量配置模板
- **重要配置**:
  - 数据库连接信息
  - Redis密码
  - JWT密钥
  - 域名配置

### 🌐 Nginx配置

#### `nginx/nginx.conf`
- **用途**: Nginx主配置文件
- **包含**: 全局设置、事件配置、HTTP配置

#### `nginx/conf.d/app.conf`
- **用途**: 应用级配置（生产使用）
- **功能**:
  - 前后端分离路由
  - API反向代理
  - WebSocket代理
  - 静态资源优化

#### `nginx/conf.d/app-detailed.conf`
- **用途**: 详细注释版配置（学习参考）
- **特点**: 每行配置都有详细解释

### 📚 学习文档

#### `docs/Nginx学习文档.md`
- **内容**: Nginx从入门到精通
- **章节**: 基础概念、配置详解、实战案例
- **适用**: 新手学习和高级参考

#### `docs/Docker学习文档.md`
- **内容**: Docker完整学习指南
- **章节**: 容器基础、镜像构建、编排部署
- **适用**: 容器化技术学习

### 🚀 部署工具

#### `deploy.sh`
- **用途**: 一键部署脚本
- **功能**:
  - 自动构建前端
  - 创建必需目录
  - 启动Docker服务
  - 健康检查

#### `README.md`
- **用途**: 完整部署指南
- **内容**:
  - 分步操作说明
  - 故障排查指南
  - 常用命令参考

## 🎯 使用流程

### 第一步：准备工作
```bash
# 1. 复制部署文件到项目根目录
cp -r integrated-deployment/* ./

# 2. 配置环境变量
cp env.example .env
# 编辑 .env 文件，修改数据库密码等配置
```

### 第二步：构建前端
```bash
# 构建Vue.js前端
npm run build

# 构建React管理后台
cd BadmintonFrontend-B && npm run build && cd ..

# 复制构建产物
mkdir -p dist/admin
cp -r dist/* ./dist/
cp -r BadmintonFrontend-B/dist/* ./dist/admin/
```

### 第三步：启动服务
```bash
# 使用自动部署脚本（推荐）
chmod +x deploy.sh
./deploy.sh

# 或手动启动
docker-compose up -d
```

### 第四步：验证部署
```bash
# 检查服务状态
docker-compose ps

# 测试访问
curl http://localhost          # Vue.js前端
curl http://localhost/admin    # React管理后台
curl http://localhost/api/health  # API健康检查
```

## 🔧 配置说明

### 环境变量配置
```bash
# 必须修改的配置
POSTGRES_PASSWORD=your_secure_password     # 数据库密码
REDIS_PASSWORD=your_redis_password         # Redis密码
JWT_SECRET=your_jwt_secret_32_chars        # JWT密钥
PROJECT_DOMAIN=your-domain.com             # 域名

# 可选配置
NODE_ENV=production                        # 运行环境
API_PORT=3000                             # API端口
WS_PORT=5000                              # WebSocket端口
```

### 端口映射
```bash
# 对外开放端口
80:80       # HTTP服务（Nginx）
443:443     # HTTPS服务（如果配置SSL）

# 内部端口（仅容器间通信）
3000        # 后端API服务
5000        # WebSocket服务
5432        # PostgreSQL数据库
6379        # Redis缓存
```

## 🛡️ 安全注意事项

### 生产环境必做
1. **修改默认密码**: 所有数据库和服务密码
2. **配置防火墙**: 只开放必要端口
3. **SSL证书**: 配置HTTPS（生产环境）
4. **定期备份**: 数据库和重要文件
5. **监控日志**: 关注异常访问

### 推荐安全配置
```bash
# 生成强密码
openssl rand -base64 32

# 配置SSL证书（Let's Encrypt推荐）
certbot --nginx -d your-domain.com

# 设置文件权限
chmod 600 .env
chmod 700 nginx/ssl/
```

## 📊 监控和维护

### 常用命令
```bash
# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f nginx
docker-compose logs -f backend-api

# 重启服务
docker-compose restart nginx

# 更新服务
docker-compose pull
docker-compose up -d
```

### 数据备份
```bash
# 备份数据库
docker-compose exec postgres-db pg_dump -U user database > backup.sql

# 备份数据卷
docker run --rm -v data_volume:/data -v $(pwd):/backup alpine tar czf /backup/data-backup.tar.gz -C /data .
```

## 🔍 故障排查

### 常见问题
1. **端口被占用**: `netstat -tlnp | grep :80`
2. **权限问题**: `sudo chown -R $USER:$USER .`
3. **容器无法启动**: `docker-compose logs [服务名]`
4. **网络问题**: `docker network ls`

### 调试技巧
```bash
# 进入容器调试
docker-compose exec nginx sh
docker-compose exec backend-api bash

# 查看容器资源使用
docker stats

# 检查配置文件语法
docker-compose config
```

## 📞 技术支持

如遇到问题，请按以下顺序排查：
1. 检查环境变量配置是否正确
2. 查看容器日志定位错误
3. 验证端口是否被占用
4. 参考学习文档中的故障排查章节
5. 检查Docker和Docker Compose版本兼容性

---

**说明**: 本文档配合其他文件使用，确保完整的部署和学习体验。
