import{az as Y,r as k,E as L,d as Z,o as ee,l as p,h as o,k as P,g as i,w as h,ap as te,j as E,ai as se,a2 as oe,P as b,Q as A,a3 as ae,a as ne,J as r,as as re,m as ie,A as N,x as m,a4 as le,i as ce,f as I,c as z}from"./index-GmfRbgMx.js";/* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                 */import{_ as de}from"./_plugin-vue_export-helper-DedD7E0N.js";/* empty css                         *//* empty css                    */import{f as ue,d as pe,O as a}from"./pay-BYbC_l-i.js";/* empty css                       *//* empty css                   */const me=Y("order",()=>{const O=k([]),_=k(!1),l=k(0),y=k(null);async function d(v=1,c=5,C=null){if(!_.value){_.value=!0;try{const u=await ue({pageNum:v,pageSize:c,status:C});if(u.data.code===0)O.value=u.data.data.list||[],l.value=u.data.data.total||0;else throw new Error(u.data.message||"获取订单列表失败")}catch(u){console.error("获取订单列表失败:",u),L.error("获取订单列表失败")}finally{_.value=!1}}}async function f(v){try{const c=await pe(v);if(c.data.code===0){const C=O.value.findIndex(u=>u.orderNo===v);return C!==-1&&(O.value[C].status=a.CANCELLED),L.success(c.data.msg||"订单取消成功"),!0}else return L.error(c.data.msg||"取消订单失败"),!1}catch(c){return console.error("取消订单失败:",c),L.error("取消订单失败"),!1}}function T(v){return O.value.find(c=>c.orderNo===v)}return{orderList:O,loading:_,fetchOrderList:d,cancelOrder:f,getOrderByNo:T,total:l,status:y}},{persist:!0}),_e={class:"order-list-container"},fe={class:"order-header"},ve={class:"order-tabs"},ge={key:0,class:"loading-container"},he={key:1,class:"empty-container"},ye={key:2,class:"order-list"},Ce={class:"order-header-info"},ke={class:"order-info"},Oe={class:"order-no"},Ee={class:"order-time"},Ne={class:"order-status"},Le={class:"order-content"},De={class:"order-products"},Pe=["onClick"],Te={class:"product-details"},xe={class:"product-name"},Ie={key:0,class:"product-specs"},Se={class:"product-price"},we={class:"product-quantity"},be={class:"order-footer"},Ae={class:"order-amount"},ze={class:"total-price"},Be={class:"order-actions"},Ue={key:3,class:"pagination-container"},Ve={__name:"OrderListView",setup(O){const _=ne(),l=me(),y=k("all"),d=k(1),f=k(5),{loading:T,cancelOrder:v,refreshOrders:c}=l,C=Z(()=>l.total),u=e=>{y.value=e,d.value=1,l.fetchOrderList(d.value,f.value,a[e])},B=e=>{f.value=e,d.value=1,l.fetchOrderList(d.value,f.value,a[y.value])},U=e=>{d.value=e,l.fetchOrderList(d.value,f.value,a[y.value])},S=e=>{_.push(`/order-detail/${e}`)},V=e=>{const t={orderNo:e.orderNo,amount:e.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(t)),_.push("/payment")},$=e=>{z.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await v(e)}).catch(()=>{})},j=e=>{z.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(async()=>{try{console.log("确认收货订单号:",e),L.success("确认收货成功"),await c()}catch(t){console.error("确认收货失败:",t),L.error("确认收货失败")}}).catch(()=>{})},R=()=>{_.push("/shop")},M=e=>{switch(e){case a.UNPAID:return"warning";case a.PAID:return"success";case a.CANCELLED:return"danger";default:return"info"}},q=e=>{switch(e){case a.UNPAID:return"待支付";case a.PAID:return"已支付";case a.CANCELLED:return"已取消";case a.COMPLETED:return"已完成";default:return"未知状态"}},F=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",J=e=>{if(!e||e===null)return!1;if(typeof e=="object"){const t=Object.entries(e);return t.length>0&&t.some(([,g])=>g!=null&&g!=="")}return!1};return ee(()=>{l.fetchOrderList()}),(e,t)=>{const g=re,H=te,Q=se,D=ie,G=oe,K=le,W=ce,X=ae;return r(),p("div",_e,[o("div",fe,[t[3]||(t[3]=o("h2",null,"我的订单",-1)),o("div",ve,[i(H,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),onTabChange:u},{default:h(()=>[i(g,{label:"全部订单",name:"all"}),i(g,{label:"待支付",name:"UNPAID"}),i(g,{label:"已支付",name:"PAID"}),i(g,{label:"已取消",name:"CANCELLED"})]),_:1},8,["modelValue"])])]),E(T)?(r(),p("div",ge,[i(Q,{rows:3,animated:""})])):E(l).orderList.length===0?(r(),p("div",he,[i(G,{description:"暂无订单数据"},{default:h(()=>[i(D,{type:"primary",onClick:R},{default:h(()=>t[4]||(t[4]=[N("去购物")])),_:1})]),_:1})])):(r(),p("div",ye,[(r(!0),p(b,null,A(E(l).orderList,s=>(r(),p("div",{key:s.orderNo,class:"order-item"},[o("div",Ce,[o("div",ke,[o("span",Oe,"订单号："+m(s.orderNo),1),o("span",Ee,m(F(s.createTime)),1)]),o("div",Ne,[i(K,{type:M(s.status)},{default:h(()=>[N(m(q(s.status)),1)]),_:2},1032,["type"])])]),o("div",Le,[o("div",De,[(r(!0),p(b,null,A(s.orderItemList,(n,x)=>(r(),p("div",{key:x,class:"product-item",onClick:w=>S(s.orderNo)},[i(W,{src:n.productImage,class:"product-image",fit:"cover"},null,8,["src"]),o("div",Te,[o("div",xe,m(n.productName),1),J(n.specs)?(r(),p("div",Ie," 规格："+m(Object.entries(n.specs).map(([,w])=>`${w}`).join("、")),1)):P("",!0),o("div",Se,"¥"+m((n.currentUnitPrice+n.priceAdjustment).toFixed(2)),1)]),o("div",we,"x"+m(n.quantity),1)],8,Pe))),128))]),o("div",be,[o("div",Ae,[o("span",null,"共"+m(s.orderItemList.reduce((n,x)=>n+x.quantity,0))+"件商品，合计：",1),o("span",ze,"¥"+m(s.totalPrice.toFixed(2)),1)]),o("div",Be,[i(D,{size:"small",onClick:n=>S(s.orderNo)},{default:h(()=>t[5]||(t[5]=[N(" 查看详情 ")])),_:2},1032,["onClick"]),s.status===E(a).UNPAID?(r(),I(D,{key:0,type:"primary",size:"small",onClick:n=>V(s)},{default:h(()=>t[6]||(t[6]=[N(" 立即支付 ")])),_:2},1032,["onClick"])):P("",!0),s.status===E(a).UNPAID?(r(),I(D,{key:1,type:"danger",size:"small",onClick:n=>$(s.orderNo)},{default:h(()=>t[7]||(t[7]=[N(" 取消订单 ")])),_:2},1032,["onClick"])):P("",!0),s.status===E(a).PAID?(r(),I(D,{key:2,type:"success",size:"small",onClick:n=>j(s.orderNo)},{default:h(()=>t[8]||(t[8]=[N(" 确认收货 ")])),_:2},1032,["onClick"])):P("",!0)])])])]))),128))])),C.value>0?(r(),p("div",Ue,[i(X,{"current-page":d.value,"onUpdate:currentPage":t[1]||(t[1]=s=>d.value=s),"page-size":f.value,"onUpdate:pageSize":t[2]||(t[2]=s=>f.value=s),"page-sizes":[5,10,15,20],total:C.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:U},null,8,["current-page","page-size","total"])])):P("",!0)])}}},Ze=de(Ve,[["__scopeId","data-v-c13f4ba5"]]);export{Ze as default};
