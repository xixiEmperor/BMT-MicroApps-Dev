import{r as $,o as T,l as y,h as s,g as a,f as h,k,w as l,j as c,ab as z,m as F,ai as M,a2 as O,at as Q,x as i,a as J,J as d,A as w,au as U,av as L,i as D,aw as R,ax as G,ay as H,c as v}from"./index-GmfRbgMx.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                         */import{_ as K}from"./_plugin-vue_export-helper-DedD7E0N.js";import{u as W}from"./cart-BCVCuu_B.js";/* empty css                       *//* empty css                 *//* empty css                   */const X={class:"cart-container"},Y={class:"cart-header"},Z={class:"cart-actions"},tt={key:0},et={key:1,class:"empty-cart"},ot={key:2,class:"cart-content"},at={class:"product-info"},nt={class:"product-details"},st={key:0,class:"product-name"},lt={key:1,class:"product-name"},rt={class:"product-price"},ct={class:"price"},it={class:"quantity-control"},dt={class:"quantity"},ut={class:"subtotal"},mt={class:"action-buttons"},_t={class:"cart-footer"},pt={class:"total-amount"},yt={class:"total-price"},wt={__name:"CartView",setup(ft){const C=J(),n=W(),m=$(!1),b=()=>{m.value=!m.value},I=async o=>{await n.increaseQuantity(o)},S=async o=>{await n.decreaseQuantity(o)},x=o=>{v.confirm(`确定要从购物车中移除 ${o.productName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await n.removeFromCart(o)}).catch(()=>{})},A=async o=>{await n.toggleSelectItem(o)},V=async()=>{await n.toggleSelectAll()},E=()=>{v.confirm("确定要清空购物车吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await n.clearCart()}).catch(()=>{})},P=()=>{const o=n.getSelectedItems();if(o.length===0){v.alert("请至少选择一件商品进行结算！","提示");return}let e=0;const f={products:o.map(_=>{const g=_.productPrice+(_.priceAdjustment||0),u=g*_.quantity;return e+=u,{..._,actualPrice:g}}),totalAmount:e};localStorage.setItem("checkout_order",JSON.stringify(f)),C.push("/checkout")},B=o=>{const e=o.productPrice+(o.priceAdjustment||0),r=e*o.quantity,f={product:{...o,actualPrice:e},totalAmount:r};localStorage.setItem("checkout_order",JSON.stringify(f)),C.push("/checkout")};return T(async()=>{n.resetLoadingState();try{await n.fetchCartList()}catch(o){console.error("获取购物车数据失败:",o)}}),(o,e)=>{const r=F,f=M,_=O,g=L,u=U,N=D,j=Q;return d(),y("div",X,[s("div",Y,[e[3]||(e[3]=s("h2",null,"我的购物车",-1)),s("div",Z,[a(r,{type:"primary",icon:c(z),onClick:b},{default:l(()=>[w(i(m.value?"完成":"编辑"),1)]),_:1},8,["icon"]),c(n).cartItems.length>0?(d(),h(r,{key:0,type:"danger",onClick:E},{default:l(()=>e[2]||(e[2]=[w(" 清空购物车 ")])),_:1})):k("",!0)])]),c(n).loading?(d(),y("div",tt,[a(f,{rows:5,animated:""})])):c(n).cartItems.length===0?(d(),y("div",et,[a(_,{description:"购物车是空的，快去添加喜欢的商品吧！"},{default:l(()=>[a(r,{type:"primary",onClick:e[0]||(e[0]=t=>o.$router.push("/shop"))},{default:l(()=>e[4]||(e[4]=[w("去购物")])),_:1})]),_:1})])):(d(),y("div",ot,[a(j,{data:c(n).cartItems,style:{width:"100%"}},{default:l(()=>[a(u,{width:"55",align:"center"},{header:l(()=>[a(g,{modelValue:c(n).isAllSelected,"onUpdate:modelValue":e[1]||(e[1]=t=>c(n).isAllSelected=t),onChange:V},null,8,["modelValue"])]),default:l(t=>[a(g,{modelValue:t.row.selected,"onUpdate:modelValue":p=>t.row.selected=p,onChange:()=>A(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(u,{label:"商品","min-width":"300"},{default:l(t=>[s("div",at,[a(N,{src:t.row.productImage,fit:"cover",class:"product-image"},null,8,["src"]),s("div",nt,[Object.keys(t.row.specs||{}).length>0?(d(),y("div",st,i(t.row.productName)+" ("+i(Object.entries(t.row.specs).map(([p,q])=>`${q}`).join("、"))+") ",1)):(d(),y("div",lt,i(t.row.productName),1)),s("div",rt,"¥"+i(t.row.productPrice+t.row.priceAdjustment),1)])])]),_:1}),a(u,{label:"单价",width:"120",align:"center"},{default:l(t=>[s("span",ct,"¥"+i(t.row.productPrice+t.row.priceAdjustment),1)]),_:1}),a(u,{label:"数量",width:"180",align:"center"},{default:l(t=>[s("div",it,[a(r,{icon:c(R),circle:"",size:"small",onClick:p=>S(t.row),disabled:t.row.quantity<=1},null,8,["icon","onClick","disabled"]),s("span",dt,i(t.row.quantity),1),a(r,{icon:c(G),circle:"",size:"small",onClick:p=>I(t.row),disabled:t.row.quantity>=t.row.stock},null,8,["icon","onClick","disabled"])])]),_:1}),a(u,{label:"小计",width:"150",align:"center"},{default:l(t=>[s("span",ut,"¥"+i(((t.row.productPrice+t.row.priceAdjustment)*t.row.quantity).toFixed(2)),1)]),_:1}),a(u,{label:"操作",width:"180",align:"center"},{default:l(t=>[s("div",mt,[m.value?(d(),h(r,{key:0,type:"danger",icon:c(H),size:"small",onClick:p=>x(t.row)},{default:l(()=>e[5]||(e[5]=[w(" 删除 ")])),_:2},1032,["icon","onClick"])):k("",!0),m.value?k("",!0):(d(),h(r,{key:1,type:"primary",size:"small",onClick:p=>B(t.row)},{default:l(()=>e[6]||(e[6]=[w(" 立即购买 ")])),_:2},1032,["onClick"]))])]),_:1})]),_:1},8,["data"]),s("div",_t,[s("div",pt,[e[7]||(e[7]=s("span",null,"总计:",-1)),s("span",yt,"¥"+i(c(n).totalPrice.toFixed(2)),1)]),a(r,{type:"primary",size:"large",onClick:P,disabled:m.value},{default:l(()=>e[8]||(e[8]=[w(" 结算 ")])),_:1},8,["disabled"])])]))])}}},Nt=K(wt,[["__scopeId","data-v-92b21634"]]);export{Nt as default};
