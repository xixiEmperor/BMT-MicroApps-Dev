import{Y as ie,r as b,K as Ee,o as he,Z as Ne,_ as He,l as y,h as e,M as be,k as X,g as l,w as n,$ as ke,a0 as $e,a1 as De,f as G,P as ee,Q as te,a2 as Me,a3 as ze,a4 as Oe,A as J,x as v,a5 as _e,E as P,a6 as Re,J as i,a7 as Pe,O as ve,m as me,a8 as Ye,d as ne,L as Te,a9 as we,aa as ye,a as Be,j as Z,ab as oe,p as Ie,ac as Ue,q as xe,ad as Fe,ae as Ae,af as Le,ag as qe,ah as je,ai as We,aj as Ze,ak as Je,U as Ke}from"./index-GmfRbgMx.js";import{c as Qe}from"./venueOrder-CAX1kHlO.js";/* empty css                   *//* empty css               *//* empty css                *//* empty css                         *//* empty css               *//* empty css                  *//* empty css                     */import{_ as pe}from"./_plugin-vue_export-helper-DedD7E0N.js";/* empty css                       *//* empty css                 *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                         */import{f as Ge}from"./format-BoKD-3ja.js";/* empty css                     *//* empty css                 */function Xe(M={}){return ie({url:"/api/reservation/notice",method:"get",params:{pageNum:M.pageNum||1,pageSize:M.pageSize||10,type:M.type||null}})}function et(M){return ie({url:`/api/reservation/notice/${M}`,method:"get"})}const tt={class:"notice-list-page"},at={class:"filter-container"},st={class:"notice-carousel-container"},lt={class:"notice-header"},ot={class:"notice-title"},nt={class:"notice-meta"},it={class:"notice-time"},rt={class:"notice-content"},ut={class:"notice-footer"},ct={key:1,class:"empty-state"},dt={key:0,class:"notice-grid"},mt={class:"notice-grid-container"},pt=["onClick"],vt={class:"grid-item-header"},_t={class:"grid-item-title"},gt={class:"grid-item-time"},ft={key:1,class:"pagination-container"},yt={class:"notice-detail"},ht={class:"detail-meta"},bt={class:"detail-time"},kt={class:"detail-content"},$t={__name:"NoticeList",setup(M){const K=b(null),z=b(!1),d=b(1),q=b(5),U=b(0),D=b([]),h=b(!1),C=Ee({id:"",title:"",content:"",type:1,publishTime:""}),V=r=>({1:"",2:"warning"})[r]||"",k=r=>({1:"普通通知",2:"重要通知"})[r]||"未知",c=r=>Ge(r,"YYYY-MM-DD HH:mm"),p=(r,m=100)=>r?r.length>m?r.substring(0,m)+"...":r:"",f=async()=>{try{z.value=!0;const r=await Xe({pageNum:d.value,pageSize:q.value,type:K.value});r.data.code===0?(D.value=r.data.data.list,U.value=r.data.data.total):P.error(r.data.msg||"获取通知列表失败")}catch(r){console.error("获取通知列表失败:",r),P.error("获取通知列表失败")}finally{z.value=!1}},a=()=>{d.value=1,f()},T=r=>{d.value=r,f()},j=r=>{q.value=r,d.value=1,f()},F=async r=>{try{const m=await et(r.id);if(m.data.code===0){const O=m.data.data;Object.assign(C,O),h.value=!0}else P.error(m.data.msg||"获取通知详情失败")}catch(m){console.error("获取通知详情失败:",m),P.error("获取通知详情失败")}};return he(()=>{Ne().subscribe("venue_notice",r=>{He({title:"通知公告",message:r.payload,type:"info"})}),f()}),(r,m)=>{const O=ke,_=$e,o=Oe,g=me,R=Pe,N=Re,L=Me,S=ze,Y=_e,re=De;return i(),y("div",tt,[m[4]||(m[4]=e("h2",{class:"page-title"},"通知公告",-1)),e("div",at,[l(_,{modelValue:K.value,"onUpdate:modelValue":m[0]||(m[0]=$=>K.value=$),placeholder:"选择通知类型",clearable:"",onChange:a},{default:n(()=>[l(O,{label:"全部通知",value:null}),l(O,{label:"普通通知",value:1}),l(O,{label:"重要通知",value:2})]),_:1},8,["modelValue"])]),be((i(),y("div",st,[D.value.length>0?(i(),G(N,{key:0,height:"300px",autoplay:!0,interval:5e3,"indicator-position":"outside",arrow:"hover",type:"card"},{default:n(()=>[(i(!0),y(ee,null,te(D.value,$=>(i(),G(R,{key:$.id,onClick:ue=>F($)},{default:n(()=>[e("div",{class:ve(["notice-card",{important:$.type===2}])},[e("div",lt,[e("h3",ot,v($.title),1),e("div",nt,[l(o,{type:V($.type),size:"small"},{default:n(()=>[J(v(k($.type)),1)]),_:2},1032,["type"]),e("span",it,v(c($.publishTime)),1)])]),e("div",rt,v(p($.content,200)),1),e("div",ut,[l(g,{type:"primary",size:"small",onClick:Ye(ue=>F($),["stop"])},{default:n(()=>m[2]||(m[2]=[J(" 查看详情 ")])),_:2},1032,["onClick"])])],2)]),_:2},1032,["onClick"]))),128))]),_:1})):X("",!0),!z.value&&D.value.length===0?(i(),y("div",ct,[l(L,{description:"暂无通知"})])):X("",!0)])),[[re,z.value]]),D.value.length>0?(i(),y("div",dt,[m[3]||(m[3]=e("h3",{class:"grid-title"},"所有通知",-1)),e("div",mt,[(i(!0),y(ee,null,te(D.value,$=>(i(),y("div",{key:`grid-${$.id}`,class:ve(["notice-grid-item",{important:$.type===2}]),onClick:ue=>F($)},[e("div",vt,[e("span",_t,v($.title),1),l(o,{type:V($.type),size:"small"},{default:n(()=>[J(v(k($.type)),1)]),_:2},1032,["type"])]),e("div",gt,v(c($.publishTime)),1)],10,pt))),128))])])):X("",!0),U.value>0?(i(),y("div",ft,[l(S,{background:"","hide-on-single-page":!1,layout:"total, sizes, prev, pager, next",total:U.value,"page-size":q.value,"page-sizes":[5,8,10],"current-page":d.value,onCurrentChange:T,onSizeChange:j},null,8,["total","page-size","current-page"])])):X("",!0),l(Y,{modelValue:h.value,"onUpdate:modelValue":m[1]||(m[1]=$=>h.value=$),title:C.title,width:"60%"},{default:n(()=>[e("div",yt,[e("div",ht,[l(o,{type:V(C.type)},{default:n(()=>[J(v(k(C.type)),1)]),_:1},8,["type"]),e("span",bt,"发布时间："+v(c(C.publishTime)),1)]),e("div",kt,v(C.content),1)])]),_:1},8,["modelValue","title"])])}}},Dt=pe($t,[["__scopeId","data-v-b58188c4"]]);function Tt(){return ie({url:"/api/venue/list",method:"get"})}function wt(M){return ie({url:"/api/venue/status-matrix",method:"get",params:M})}function xt(M){return ie({url:"/api/venue/availability",method:"get",params:M})}const Ct={class:"matrix-container"},Vt={class:"date-selector"},St={class:"date-info"},Et={key:0,class:"workday-info"},Nt={key:1,class:"weekend-info"},Ht={class:"legend"},Mt={class:"legend-text"},zt={class:"matrix-table"},Ot={class:"status-matrix"},Rt={class:"venue-name"},Pt=["onClick","title"],Yt={class:"dialog-footer"},Bt={__name:"VenueStatusMatrix",props:{visible:{type:Boolean,default:!1}},emits:["close"],setup(M,{emit:K}){const z=M,d=ne({get:()=>z.visible});Te(()=>z.visible,_=>{_&&a()},{immediate:!0});const q=K,U=()=>{q("close")},D=b(!1),h=b({}),C=b(new Date),V=b([]),k=b([]),c={1:"#67c23a",2:"#909399",3:"#f56c6c",4:"#e6a23c"},p={1:"空闲中",2:"使用中",3:"已预约",4:"不开放"},f=_=>{const o=_.getFullYear(),g=String(_.getMonth()+1).padStart(2,"0"),R=String(_.getDate()).padStart(2,"0");return`${o}-${g}-${R}`},a=async()=>{if(z.visible){D.value=!0;try{const _=f(C.value),o=await wt({date:_});o.data.code===0&&(h.value=o.data.data.statusMatrix||{},k.value=o.data.data.venues||[],V.value=o.data.data.timeSlots||[])}catch(_){console.error("获取场地状态矩阵失败:",_),P.error("获取场地状态矩阵失败")}finally{D.value=!1}}},T=_=>{const o=_.getDay();return o>=1&&o<=5},j=_=>{const o=new Date;o.setHours(0,0,0,0);const g=new Date(o);g.setDate(g.getDate()+1);const R=new Date(_);return R.setHours(0,0,0,0),!(R.getTime()===o.getTime()||R.getTime()===g.getTime())},F=(_,o)=>{const g=h.value[_];return!g||!g[o]?1:g[o].status},r=(_,o)=>{const g=F(_,o);return{backgroundColor:c[g],color:"#fff",textAlign:"center",padding:"8px 4px",fontSize:"12px",cursor:"pointer",transition:"all 0.3s"}},m=(_,o)=>{const g=h.value[_.id];if(!g||!g[o])return;const R=g[o],N=R.status;let L="";N!==1?L=`${_.name} ${o} - ${p[N]} - ${R.reason}`:L=`${_.name} ${o} - ${p[N]}`,N===1?P.success(L):N===2?P.warning(L):N===3?P.error(L):N===4&&P.warning(L)},O=()=>{a()};return(_,o)=>{const g=we,R=me,N=_e,L=De;return i(),G(N,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=S=>d.value=S),title:"场地使用情况表",width:"90%","close-on-click-modal":!1,onClose:U,class:"venue-matrix-dialog"},{footer:n(()=>[e("div",Yt,[l(R,{onClick:U},{default:n(()=>o[4]||(o[4]=[J("关闭")])),_:1}),l(R,{type:"primary",onClick:a},{default:n(()=>o[5]||(o[5]=[J("刷新数据")])),_:1})])]),default:n(()=>[e("div",Ct,[e("div",Vt,[l(g,{modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=S=>C.value=S),type:"date",placeholder:"选择查询日期",format:"YYYY年MM月DD日",onChange:O,"disabled-date":j},null,8,["modelValue"]),e("div",St,[T(C.value)?(i(),y("span",Et," 工作日：白天场地用于校内上课，仅晚上18:00-21:00开放预约 ")):(i(),y("span",Nt," 周末：全天开放预约，时间为8:00-21:00 "))])]),e("div",Ht,[(i(),y(ee,null,te(c,(S,Y)=>e("div",{class:"legend-item",key:Y},[e("div",{class:"legend-color",style:ye({backgroundColor:S})},null,4),e("span",Mt,v(p[Y]),1)])),64))]),be((i(),y("div",zt,[e("table",Ot,[e("thead",null,[e("tr",null,[o[2]||(o[2]=e("th",{class:"venue-header"},"场地/时间",-1)),(i(!0),y(ee,null,te(V.value,S=>(i(),y("th",{key:S,class:"time-header"},v(S),1))),128))])]),e("tbody",null,[(i(!0),y(ee,null,te(k.value,S=>(i(),y("tr",{key:S.id},[e("td",Rt,v(S.name),1),(i(!0),y(ee,null,te(V.value,Y=>(i(),y("td",{key:Y,class:"status-cell",style:ye(r(S.id,Y)),onClick:re=>m(S,Y),title:`${S.name} ${Y} - ${p[F(S.id,Y)]}`},v(p[F(S.id,Y)]),13,Pt))),128))]))),128))])])])),[[L,D.value]]),o[3]||(o[3]=e("div",{class:"matrix-info"},[e("p",null,[e("strong",null,"使用说明：")]),e("ul",null,[e("li",null,"点击单元格可查看详细信息"),e("li",null,"绿色表示可预约，红色表示已预约，橙色表示维护中，灰色表示不开放"),e("li",null,"工作日白天时间段场地用于校内上课，不对外开放"),e("li",null,"周末全天开放预约")])],-1))])]),_:1},8,["modelValue"])}}},It=pe(Bt,[["__scopeId","data-v-64f68edf"]]),Ut={class:"create-order-form"},Ft={class:"form-header"},At={class:"form-title"},Lt={class:"form-section venue-section"},qt={class:"section-header"},jt={key:0,class:"venue-card"},Wt={class:"venue-info"},Zt={class:"venue-name"},Jt={class:"venue-description"},Kt={class:"venue-price"},Qt={class:"price-value"},Gt={class:"form-section time-section"},Xt={class:"section-header"},ea={class:"time-display-grid"},ta={class:"time-display-item"},aa={class:"time-value"},sa={class:"time-display-item"},la={class:"time-value"},oa={class:"time-display-item"},na={class:"time-value"},ia={key:0,class:"booking-summary"},ra={class:"summary-item"},ua={class:"summary-value"},ca={class:"summary-item total-price"},da={class:"summary-value price"},ma={class:"price-note"},pa={class:"form-section contact-section"},va={class:"section-header"},_a={class:"contact-form-grid"},ga={class:"form-section notice-section"},fa={class:"section-header"},ya={class:"notice-content"},ha={class:"form-actions"},ba={__name:"CreateOrderForm",props:{selectedVenue:{type:Object,default:()=>({})},reservationDate:{type:String,default:""},startTime:{type:String,default:""},endTime:{type:String,default:""}},emits:["cancel"],setup(M,{emit:K}){const z=Be(),d=M,q=K,U=b(null),D=b(!1),h=b({venueId:"",contactName:"",contactPhone:"",remark:""}),C={venueId:[{required:!0,message:"请选择场地",trigger:"change"}],contactName:[{required:!0,message:"请输入联系人姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度在2-20个字符",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5a-zA-Z\s]+$/,message:"姓名只能包含中文、英文和空格",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],remark:[{max:200,message:"备注不能超过200个字符",trigger:"blur"}]},V=ne(()=>{if(!d.startTime||!d.endTime)return 0;const[f]=d.startTime.split(":").map(Number),[a]=d.endTime.split(":").map(Number);return a-f}),k=ne(()=>{var a;const f=((a=d.selectedVenue)==null?void 0:a.price)||30;return Math.ceil(V.value)*f});Te(()=>d.selectedVenue,f=>{f!=null&&f.id&&(console.log(f),h.value.venueId=f.id)},{immediate:!0});const c=async()=>{if(!U.value)return!1;try{await U.value.validate();const f={venueId:d.selectedVenue.id,reservationDate:d.reservationDate,startTime:d.startTime,endTime:d.endTime,remark:h.value.contactName+" "+h.value.contactPhone+" "+h.value.remark};D.value=!0;try{P.info("正在创建订单...");const a=await Qe(f);if(a.data.code===0)z.push({path:"/payment",query:{orderNo:a.data.data.orderNo},state:{orderDetail:{id:a.data.data.id,venueName:d.selectedVenue.name,venueId:d.selectedVenue.id,reservationDate:f.reservationDate,startTime:f.startTime,endTime:f.endTime,duration:V.value,contactName:h.value.contactName,contactPhone:h.value.contactPhone,remark:a.data.data.remark,payTypeDesc:a.data.data.payTypeDesc,pricePerHour:a.data.data.pricePerHour||30,totalAmount:a.data.data.totalAmount}}});else return P.error(a.data.message||"创建订单失败"),!1}catch(a){return console.error("创建订单失败:",a),P.error("创建订单失败，请重试"),!1}finally{D.value=!1}}catch(f){return console.error("表单验证失败:",f),!1}},p=()=>{q("cancel")};return(f,a)=>{const T=Ie,j=Le,F=Ae,r=qe,m=me,O=je;return i(),y("div",Ut,[e("div",Ft,[e("h3",At,[l(T,null,{default:n(()=>[l(Z(oe))]),_:1}),a[3]||(a[3]=J(" 创建预约订单 "))]),a[4]||(a[4]=e("p",{class:"form-subtitle"},"请填写完整的预约信息，确保信息准确无误",-1))]),l(O,{ref_key:"formRef",ref:U,model:h.value,rules:C,"label-width":"100px",class:"order-form",size:"large"},{default:n(()=>{var _,o;return[e("div",Lt,[e("div",qt,[l(T,{class:"section-icon"},{default:n(()=>[l(Z(Ue))]),_:1}),a[5]||(a[5]=e("h4",{class:"section-title"},"场地信息",-1))]),(_=d.selectedVenue)!=null&&_.id?(i(),y("div",jt,[e("div",Wt,[e("h5",Zt,v(d.selectedVenue.name),1),e("p",Jt,v(d.selectedVenue.description||"标准羽毛球场地，配备专业羽毛球网和照明设备"),1),e("div",Kt,[a[6]||(a[6]=e("span",{class:"price-label"},"价格：",-1)),e("span",Qt,v(d.selectedVenue.price||30)+"元/小时",1)])])])):X("",!0)]),e("div",Gt,[e("div",Xt,[l(T,{class:"section-icon"},{default:n(()=>[l(Z(xe))]),_:1}),a[7]||(a[7]=e("h4",{class:"section-title"},"预约时间",-1))]),e("div",ea,[e("div",ta,[a[8]||(a[8]=e("span",{class:"time-label"},"预约日期",-1)),e("div",aa,v(d.reservationDate||"未选择"),1)]),e("div",sa,[a[9]||(a[9]=e("span",{class:"time-label"},"开始时间",-1)),e("div",la,v(d.startTime||"未选择"),1)]),e("div",oa,[a[10]||(a[10]=e("span",{class:"time-label"},"结束时间",-1)),e("div",na,v(d.endTime||"未选择"),1)])]),V.value>0?(i(),y("div",ia,[e("div",ra,[l(T,null,{default:n(()=>[l(Z(Fe))]),_:1}),a[11]||(a[11]=e("span",{class:"summary-label"},"预约时长：",-1)),e("span",ua,v(V.value)+"小时",1)]),e("div",ca,[l(T,null,{default:n(()=>[l(Z(oe))]),_:1}),a[12]||(a[12]=e("span",{class:"summary-label"},"预计费用：",-1)),e("span",da,"¥"+v(k.value),1)]),e("div",ma," （按"+v(((o=d.selectedVenue)==null?void 0:o.price)||30)+"元/小时计算，不足1小时按1小时计费） ",1)])):X("",!0)]),e("div",pa,[e("div",va,[l(T,{class:"section-icon"},{default:n(()=>[l(Z(oe))]),_:1}),a[13]||(a[13]=e("h4",{class:"section-title"},"联系人信息",-1))]),e("div",_a,[l(F,{label:"联系人姓名",prop:"contactName"},{default:n(()=>[l(j,{modelValue:h.value.contactName,"onUpdate:modelValue":a[0]||(a[0]=g=>h.value.contactName=g),placeholder:"请输入联系人姓名",disabled:D.value,clearable:"",size:"large"},{prefix:n(()=>[l(T,null,{default:n(()=>[l(Z(oe))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(F,{label:"联系电话",prop:"contactPhone"},{default:n(()=>[l(j,{modelValue:h.value.contactPhone,"onUpdate:modelValue":a[1]||(a[1]=g=>h.value.contactPhone=g),placeholder:"请输入手机号码",disabled:D.value,clearable:"",size:"large",maxlength:"11"},{prefix:n(()=>[l(T,null,{default:n(()=>[l(Z(oe))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),l(F,{label:"备注信息",prop:"remark"},{default:n(()=>[l(j,{modelValue:h.value.remark,"onUpdate:modelValue":a[2]||(a[2]=g=>h.value.remark=g),type:"textarea",placeholder:"请输入备注信息（选填）",disabled:D.value,rows:3,maxlength:"200","show-word-limit":"",resize:"none"},null,8,["modelValue","disabled"])]),_:1})]),e("div",ga,[e("div",fa,[l(T,{class:"section-icon"},{default:n(()=>[l(Z(oe))]),_:1}),a[14]||(a[14]=e("h4",{class:"section-title"},"预约须知",-1))]),e("div",ya,[l(r,{title:"重要提醒",type:"warning",closable:!1,"show-icon":""},{default:n(()=>a[15]||(a[15]=[e("ul",{class:"notice-list"},[e("li",null,"请确保预约信息准确无误，提交后不可修改"),e("li",null,"如需取消预约，请至少提前半小时联系管理员"),e("li",null,"请爱护场地设施，如有损坏需要赔偿"),e("li",null,"场地内禁止吸烟，请保持环境整洁")],-1)])),_:1})])]),e("div",ha,[l(m,{size:"large",disabled:D.value,onClick:p},{default:n(()=>a[16]||(a[16]=[J(" 取消 ")])),_:1},8,["disabled"]),l(m,{type:"primary",size:"large",loading:D.value,onClick:c},{default:n(()=>[J(v(D.value?"创建中...":"确认预约"),1)]),_:1},8,["loading"])])]}),_:1},8,["model"])])}}},ka=pe(ba,[["__scopeId","data-v-3d5b6ff2"]]),$a={class:"booking-container"},Da={class:"booking-tools"},Ta={class:"date-time-selector"},wa={class:"selector-group"},xa={class:"matrix-button-container"},Ca={class:"date-status"},Va={class:"status-text"},Sa={key:0,class:"selector-group time-selector"},Ea={class:"time-picker-container"},Na={class:"time-picker"},Ha={class:"time-picker"},Ma={class:"courts-container"},za={key:0,class:"loading-container"},Oa={class:"court-info"},Ra={class:"court-name"},Pa={class:"court-status"},Ya={class:"court-description"},Ba={class:"court-price"},Ia={__name:"BookingView",setup(M){const K=s=>{const t=s.getFullYear(),w=String(s.getMonth()+1).padStart(2,"0"),x=String(s.getDate()).padStart(2,"0");return`${t}-${w}-${x}`},z=s=>{const t=s.getDay();return t>=1&&t<=5},d=s=>{const t=s.getDay();return t===0||t===6},q=(s,t)=>{const w=new Date,x=new Date;x.setHours(0,0,0,0);const E=new Date(x);E.setDate(E.getDate()+1);const B=new Date(s);if(B.setHours(0,0,0,0),B.getTime()===x.getTime()){const[A,W]=t.split(":").map(Number),H=new Date;return H.setHours(A,W,0,0),w.getTime()<H.getTime()}return B.getTime()===E.getTime()?w.getHours()>=18:!1},U=s=>{const t=new Date,w=new Date;w.setHours(0,0,0,0);const x=new Date(w);x.setDate(x.getDate()+1);const E=new Date(s);return E.setHours(0,0,0,0),E.getTime()===x.getTime()&&t.getHours()<18?"不在可预约时间（明天场地需今天18:00后预约）":null},D=s=>z(s)?["18:00-21:00"]:d(s)?["8:00-21:00"]:[],h=s=>{const t=D(s);if(t.length===0)return{startOptions:[],endOptions:[]};const w=[],x=[],E=t[0],[B,A]=E.split("-"),[W,H]=B.split(":").map(Number),[I,Q]=A.split(":").map(Number);let se=W,u=H,ae=I-1,le=Q;for(le<u&&(ae-=1,le+=60);se<ae||se===ae&&u<=le;){const de=`${se.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`;q(s,de)&&w.push(de),se+=1}let ce=W+1,fe=H;for(;ce<I||ce===I&&fe<=Q;){const de=`${ce.toString().padStart(2,"0")}:${fe.toString().padStart(2,"0")}`;x.push(de),ce+=1}const Ve=[...new Set(w)].sort(),Se=[...new Set(x)].sort();return{startOptions:Ve,endOptions:Se}},C=ne(()=>h(k.value).startOptions||[]),V=ne(()=>{const s=h(k.value);if(!c.value||s.endOptions.length===0)return[];const[t,w]=c.value.split(":").map(Number),E=`${(t+3).toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`;return s.endOptions.filter(B=>B<=E&&B>c.value)}),k=b(new Date),c=b("18:00"),p=b("19:00");z(k.value)?(c.value="18:00",p.value="21:00"):(c.value="8:00",p.value="21:00");const f=async s=>{C.value.length>0?(c.value=C.value[0],V.value.length>0&&(p.value=V.value[0])):(c.value="",p.value=""),c.value&&p.value&&c.value<p.value&&await r(s,c.value,p.value)},a=s=>{let t="";z(s)?t="工作日（仅晚上18:00-21:00开放）":d(s)&&(t="周末（全天开放8:00-21:00）");const w=U(s);return w&&(t+=` - ${w}`),t},T=b([]),j=b(!1),F=async()=>{j.value=!0;try{const s=await Tt();s.data.code===0?T.value=s.data.data.map(t=>({id:t.id,name:t.name,description:t.description,price:t.pricePerHour||20,status:t.status,bookable:!1,availabilityReason:"请选择时间段",location:t.location})):P.error(s.message||"获取场地列表失败")}catch(s){console.error("获取场地列表失败:",s),P.error("获取场地列表失败，请稍后重试")}finally{j.value=!1}},r=async(s,t,w)=>{try{const x=U(s);if(x||!q(s,t)){T.value.forEach(A=>{A.bookable=!1,A.availabilityReason=x||"不在可预约时间"});return}const E=K(s),B=await xt({date:E,startTime:t,endTime:w});if(B.data.code===0){const{availableVenues:A,unavailableVenues:W}=B.data.data;T.value.forEach(H=>{H.bookable=!1,H.availabilityReason="未知状态"}),A&&A.length>0&&A.forEach(H=>{const I=T.value.find(Q=>Q.id===H.id);I&&(I.bookable=!0,I.availabilityReason="可预约",H.pricePerHour!==void 0&&(I.price=H.pricePerHour))}),W&&W.length>0&&W.forEach(H=>{const I=T.value.find(Q=>Q.id===H.id);I&&(I.bookable=!1,I.availabilityReason=H.reason||"不可预约")})}}catch(x){console.error("检查场地可用性失败:",x),T.value.forEach(E=>{E.bookable=!1,E.availabilityReason="检查失败"})}};he(async()=>{await F(),await f(k.value),await ge(c.value)});const m=b(!1),O=b(null),_=b(null),o=s=>{O.value=s,m.value=!0},g=()=>{m.value=!1,O.value=null},R=()=>{g()},N=b(!1),L=()=>{N.value=!1},S=()=>{N.value=!0},Y=s=>!s.bookable||!c.value||!p.value?!1:q(k.value,c.value),re=s=>s.bookable?"status-available":s.availabilityReason&&s.availabilityReason!=="请选择时间段"?"status-booked":"status-closed",$=s=>s.bookable?"可预约":s.availabilityReason||"状态未知",ue=async()=>{g(),P.success("预约成功！"),c.value&&p.value&&await r(k.value,c.value,p.value)},ge=async s=>{if(C.value.length===0)return;s>=p.value&&(p.value=V.value[0]);const t=p.value.split(":").map(Number)[0],w=s.split(":").map(Number)[0];t-w>3&&(p.value=V.value[V.value.length-1]),p.value&&await r(k.value,s,p.value)},Ce=async s=>{if(s<=c.value)if(z(k.value)){const t=V.value.indexOf(s);c.value=C.value[t]}else c.value="18:00";c.value&&await r(k.value,c.value,s)};return(s,t)=>{var se;const w=we,x=me,E=ke,B=$e,A=We,W=Ke,H=Je,I=Ze,Q=_e;return i(),y("div",$a,[t[12]||(t[12]=e("div",{class:"page-header"},[e("h2",null,"场地预约")],-1)),l(Dt),e("div",Da,[e("div",Ta,[e("div",wa,[t[5]||(t[5]=e("p",null,"选择日期：",-1)),l(w,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=u=>k.value=u),type:"date",placeholder:"选择预约日期","disabled-date":u=>{const ae=new Date;ae.setHours(0,0,0,0);const le=new Date(ae);return le.setDate(le.getDate()+1),!(u.toDateString()===ae.toDateString()||u.toDateString()===le.toDateString())},format:"YYYY年MM月DD日",onChange:f},null,8,["modelValue","disabled-date"])]),e("div",xa,[l(x,{type:"primary",icon:Z(xe),onClick:S,class:"matrix-button-enhanced",size:"large"},{default:n(()=>t[6]||(t[6]=[e("span",{class:"button-text"},"查看场地使用情况表",-1),e("span",{class:"button-subtitle"},"实时查看所有场地状态",-1)])),_:1},8,["icon"])]),e("div",Ca,[e("span",Va,v(a(k.value)),1)]),C.value.length>0?(i(),y("div",Sa,[t[8]||(t[8]=e("p",null,"时间段：",-1)),e("div",Ea,[e("div",Na,[l(B,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=u=>c.value=u),placeholder:"开始时间",onChange:ge,class:"time-select"},{default:n(()=>[(i(!0),y(ee,null,te(C.value,u=>(i(),G(E,{key:u,label:u,value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t[7]||(t[7]=e("span",{class:"time-separator"},"至",-1)),e("div",Ha,[l(B,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=u=>p.value=u),placeholder:"结束时间",onChange:Ce,class:"time-select"},{default:n(()=>[(i(!0),y(ee,null,te(V.value,u=>(i(),G(E,{key:u,label:u,value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])])):X("",!0)]),t[9]||(t[9]=e("div",{class:"booking-rules"},[e("p",null,[e("strong",null,"预约规则：")]),e("ul",null,[e("li",null,"工作日（周一至周五）：白天场地用于校内上课，仅晚上18:00-21:00开放预约"),e("li",null,"周末（周六、周日）：全天开放预约，时间为8:00-21:00"),e("li",null,"预约时长为1-3小时，每小时20元，时间选择步长为1小时"),e("li",null,"一人一天只能预约一次，如果当天已预约则无法再次预约"),e("li",null,"只能预约今天和明天的场地"),e("li",null,"今天场地：只要在开始时间之前都可以预约（如果有剩余）"),e("li",null,"明天场地：今天18:00之后才能开始预约")])],-1))]),e("div",Ma,[t[11]||(t[11]=e("h3",null,"场地状态",-1)),j.value?(i(),y("div",za,[l(A,{rows:3,animated:""}),t[10]||(t[10]=e("p",{class:"loading-text"},"正在加载场地信息...",-1))])):(i(),G(I,{key:1,gutter:20},{default:n(()=>[(i(!0),y(ee,null,te(T.value,u=>(i(),G(H,{xs:24,sm:12,md:8,key:u.id},{default:n(()=>[l(W,{class:ve(["court-card",re(u)])},{default:n(()=>[e("div",Oa,[e("div",Ra,v(u.name),1),e("div",Pa,v($(u)),1),e("div",Ya,v(u.description),1),e("div",Ba,"¥"+v(u.price)+"/小时",1),l(x,{type:"primary",disabled:!Y(u),onClick:ae=>o(u),class:"book-button"},{default:n(()=>[J(v(Y(u)?"立即预约":"暂不可预约"),1)]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}))]),l(Q,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=u=>m.value=u),title:`预约 ${(se=O.value)==null?void 0:se.name}`,width:"600px",onClose:g},{default:n(()=>[O.value?(i(),G(ka,{key:0,ref_key:"createOrderFormRef",ref:_,court:O.value,date:k.value,"start-time":c.value,"end-time":p.value,onSuccess:ue,onCancel:R},null,8,["court","date","start-time","end-time"])):X("",!0)]),_:1},8,["modelValue","title"]),l(Q,{modelValue:N.value,"onUpdate:modelValue":t[4]||(t[4]=u=>N.value=u),title:"场地使用情况表",width:"90%",onClose:L},{default:n(()=>[N.value?(i(),G(It,{key:0,"current-date":k.value,"start-time":c.value,"end-time":p.value},null,8,["current-date","start-time","end-time"])):X("",!0)]),_:1},8,["modelValue"])])}}},ns=pe(Ia,[["__scopeId","data-v-7de6964d"]]);export{ns as default};
